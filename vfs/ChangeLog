2002-07-15  Pavel Roskin  <proski@gnu.org>

	* cpio.c (cpio_read_crc_head): Undo change in the error message.

	* ftpfs.c: Replace bzero and bcopy with memset and memcpy.
	* mcfs.c: Likewise.
	* mcserv.c: Likewise.
	* smbfs.c: Likewise.
	* tar.c: Likewise.

2002-07-14  Pavel Roskin  <proski@gnu.org>

	* fish.c (open_archive_int): Don't combine "export" and
	assignment into one command - it's not portable.  Set LC_TIME
	to "C" as well.

	* fish.c (open_archive_int): Set remote locale to C, otherwise
	timestamps cannot be parsed in some locales.

2002-07-12  Pavel Roskin  <proski@gnu.org>

	* fish.c (file_store): Reduce input block size to 256 bytes,
	otherwise dd gets partial blocks.

	* ftpfs.c (login_server) [HSC_PROXY]: Fix crash.

	* ftpfs.c (ftp_split_url): Implement looking up password in
	.netrc for known user.

	* ftpfs.c (ftp_split_url): Don't expect lookup_netrc() to always
	return a username.
	(netrc_has_incorrect_mode): Don't free anything, it can result
	in freeing some variables twice.
	(find_machine): New function to find matching "machine" or
	"default" token.
	(lookup_netrc): Eliminate external loop - scan for login and
	password, but don't fallback to another string in case of
	trouble.

	* ftpfs.c: Introduce enum keyword_t to improve readability.
	(netrc_next): Fix return value for unknown keywords.
	(lookup_netrc): Remove special processing of "*netrc*".

	* ftpfs.c (ftp_split_url): Move protection against pass being
	NULL ...
	(lookup_netrc): ... here.

2002-07-11  Pavel Roskin  <proski@gnu.org>

	* xdirentry.h: Eliminate use_proxy field.
	* ftpfs.c (open_archive_int): Use SUP.proxy instead of
	SUP.use_proxy.
	(open_archive): Set SUP.proxy to ftpfs_proxy_host.
	* ftpfs.h: Eliminate unused structures.

	* vfs.h: Rename URL_DEFAULTANON to URL_ALLOW_ANON.
	* utilvfs.c (vfs_split_url): Return NULL as username if
	URL_ALLOW_ANON is set and no username is found in the URL,
	otherwise use current name.
	* ftpfs.c (ftp_split_url): New function - split URL and look up
	username and password if needed.
	(login_server): Use ftp_split_url().
	(archive_same): Likewise.

2002-07-10  Pavel Roskin  <proski@gnu.org>

	* tcputil.h: Move use_netrc declaration ...
	* vfs.h: ... here.
	* ftpfs.c: Implement .netrc support unconditionally.
	(lookup_netrc): Make static.
	* utilvfs.c: Initialize default_is_netrc.
	From Thomas Zajic <zlatko@gmx.at>

	* direntry.c (vfs_s_open): Don't pass O_LINEAR to open() -
	this flag is for VFS only, and causes side effects in Cygwin.
	* extfs.c (extfs_open): Likewise.
	* sfs.c (sfs_open): Likewise.
	Reported by Pavel Tsekov <ptsekov@gmx.net>

2002-07-03  Pavel Roskin  <proski@gnu.org>

	* ftpfs.c (setup_passive): Cast arguments to isdigit() to
	unsigned char for compatibility with non-GNU libc.
	* tar.c (from_oct): Likewise with isspace().
	Reported by Roland Illig <1illig@informatik.uni-hamburg.de>

2002-07-03  Andrew V. Samoilov  <kai@cmail.ru>

	* extfs.c (extfs_fill_names): Generate filename#vfsname/dir
	instead of #vfsname/filename/dir.  Use PATH_SEP_STR.

	* sfs.c (sfs_free): Fix memory leak.
	(sfs_init): Use PATH_SEP_STR.

2002-07-03  Pavel Roskin  <proski@gnu.org>

	* cpio.c (cpio_open_cpio_file): Fix type initialization.
	From Andrew V. Samoilov <kai@cmail.ru>

2002-07-02  Pavel Roskin  <proski@gnu.org>

	* Makefile.am: Add samba to SUBDIRS.  Forcedly set DISTDIRS to
	extfs.  Remove parts that are now handled by samba/Makefile.
	* samba/Makefile.in: Add more empty targets for Automake
	compatibility.

	* ftpfs.c (send_ftp_command): Use "anonymous@" as default
	anonymous password.
	From Eduardo Perez Ureta <eperez@it.uc3m.es>

2002-06-25  Pavel Roskin  <proski@gnu.org>

	* vfs.c: Add protection against NULL strings to all is_*()
	functions.

2002-06-21  Andrew V. Samoilov  <kai@cmail.ru>

	* smbfs.c: Undefine PACKAGE_BUGREPORT, PACKAGE_NAME,
	PACKAGE_STRING, PACKAGE_TARNAME and PACKAGE_VERSION
	before including "samba/include/config.h" to prevent warnings.
	(smbfs_init): Set DEBUGLEVEL to 0.
	(do_connect): Rename to ...
	(smbfs_do_connect): ... this to avoid namespace clash and
	make static.  Make server const. Adjust all callers.
	(smbfs_add_dots): Remove.
	(smbfs_stat): Remove code duplication.
	(smbfs_lstat): Define as smbfs_stat.

	* samba/lib/system.c (sys_ftruncate): Commented out.
	* samba/lib/util.c (set_filelen): Likewise.
	(setbuffer): Likewise.

	* Makefile.am (SAMBA_DIST): Remove tests/ftruncate.c
	* samba/tests/ftruncate.c: Removed.
	* samba/configure.in: Don't check if ftruncate() can
	extend a file.

2002-06-06  Andrew V. Samoilov  <kai@cmail.ru>

	* cpio.c (cpio_read_oldc_head): Use char[] for buf instead
	of char*[].  Remove unneeded casts.  Fix error message.
	(cpio_create_entry): G_free name.  Fix offset calculation
	for symbolic links.

2002-05-22  Pavel Roskin  <proski@gnu.org>

	* Makefile.am (mcserv_SOURCES): Remove $(top_srcdir)/src/mad.c,
	it breaks "make distcheck".

	* Makefile.am: Set samba_libsamba_a_SOURCES to an empty value
	to override the default.

2002-05-22  Andrew V. Samoilov  <kai@cmail.ru>

	* xdirentry.h (vfs_s_fh.u.ftp): Add append field.
	(vfs_s_data.file_store): Change second argument
	to (vfs_s_fh *fh).
	* direntry.c (vfs_s_close): Adjust.
	* fish.c (file_store): Likewise.
	* ftpfs.c (file_store): Likewise.  Use "APPE" if
	fh->u.ftp.append is true.
	(linear_start): Care about fh->u.ftp.append.
	(ftpfs_fh_open): Likewise.

	* fish.c (fish_fh_open): Generate fh->ino->localname
	if this one is NULL and file is opened for writting only.
	* ftpfs.c (ftpfs_fh_open): Likewise if control_connection_buzy
	is true.

2002-05-21  Andrew V. Samoilov  <kai@cmail.ru>

	* direntry.c (vfs_s_retrieve_file): Please, care about
	fish.local_stat ...
	* fish.c (linear_close): ... here.

	* ftpfs.c (linear_read): Unset control_connection_buzy
	on EOF.
	(ftpfs_fh_close): Call vfs_s_invalidate ().

	* fish.c (fish_fh_open): Don't retrieve file if it is
	opened for writting only.

2002-05-17  Andrew V. Samoilov  <kai@cmail.ru>

	* xdirentry.h (vfs_s_super): Add control_connection_buzy
	field to ftp struct.

	* ftpfs.c (linear_start): Set control_connection_buzy.
	(linear_abort): Unset control_connection_buzy.
	(ftpfs_fh_open): Don't retrieve file if it is
	opened for writting only.  Open data connection as
	fh->handle and unlink/unset local temporary file
	if control connection isn't buzy.
	(ftpfs_fh_close): New function to serve opened in
	ftpfs_fh_open() data connection.  Unset fh->changed
	to prevent MEDATA->file_store() call from vfs_s_close().

	* direntry.c (vfs_s_read): Move MEDATA->linear_start() ...
	(vfs_s_open): ... here.

	* samba/include/includes.h: Eliminate all references to
	HAVE_LIBREADLINE.

2002-05-14  Andrew V. Samoilov  <kai@cmail.ru>

	* Makefile.am (noinst_LIBRARIES): Add samba/libsamba.a
	if USE_SAMBA_FS is true.
	(libvfs-mc.a): Don't merge object files with libsamba.a.

2002-05-13  Andrew V. Samoilov  <kai@cmail.ru>

	* Makefile.am (mcserv_SOURCES): Add $(top_srcdir)/src/mad.c.

	* vfs.c (MC_RENAMEOP): Make arguments const.
	* vfs.h (mc_rename): Adjust declaration.
	(mc_link): Likewise.

2002-05-11  Andrew V. Samoilov  <kai@cmail.ru>

	* samba/configure.in: Add AC_SYS_LARGEFILE.
	Don't check atexit, setreuid, setregid, setegid and setluid.

2002-04-31  Pavel Roskin  <proski@gnu.org>

	* samba/acconfig.h: Remove.
	* Makefile.am: Remove references to samba/acconfig.h.
	* samba/Makefile.in: Likewise.
	* samba/aclocal.m4: Remove unused test AC_DIRENT_D_OFF.
	* samba/configure.in: Add descriptions to AC_DEFINE calls.
	Remove unused tests.
	* samba/include/includes.h: Cleanup for the symbols that
	samba/configure.in doesn't define.
	* samba/lib/netmask.c: Likewise.

	* samba/include/includes.h: Eliminate all references to
	HAVE_EXPLICIT_LARGEFILE_SUPPORT.
	* samba/lib/system.c: Likewise.

2002-04-24  Andrew V. Samoilov  <kai@cmail.ru>

	* vfs.c (vfs_print_stats): s/transfered/transferred/

	* samba/lib/signal.c: Remove.

	* samba/lib/debug.c (sig_usr2): Commented out.
	(sig_usr1): Likewise.
	* samba/lib/util_file.c (gotalarm): Commented out.
	(gotalarm_sig): Likewise.
	(do_file_lock): Likewise.
	(file_lock): Likewise.
	(file_unlock): Likewise.
	(startfilepwent): Likewise.
	(endfilepwent): Likewise.

	* samba/Makefile.in (SAMBAFILES): Remove lib/signal.o.
	* Makefile.am (SAMBA_DIST): Remove lib/signal.c.

2002-04-19  Andrew V. Samoilov  <kai@cmail.ru>

	* vfs.c (vfs_init) [!WITH_MCFS]: Don't register mcfs.

2002-04-12  Pavel Roskin  <proski@gnu.org>

	* extfs/trpm: update to work with rpm 4.x.
	Reported by m.lusini@palazzochigi.it
	https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=62306

2002-04-12  Andrew V. Samoilov  <kai@cmail.ru>

	* cpio.c (cpio_skip_padding): Handle old ASCII format.

2002-04-08  Pavel Roskin  <proski@gnu.org>

	* samba/configure.in: Require Autoconf 2.52 to make Debian
	wrapper around Autoconf happy.
	From Björn Eriksson <bjorn@bjornen.nu>

2002-03-06  Andrew V. Samoilov  <kai@cmail.ru>

	* direntry.c (vfs_s_resolve_symlink): Comment out buggy code.
	(vfs_s_retrieve_file): Set fh->handle to -1.
	(vfs_s_read): Don't manipulate with FH->handle if it is -1.
	(vfs_s_write): Likewise.
	(vfs_s_close): Likewise.

2002-02-27  Andrew V. Samoilov  <kai@cmail.ru>

	* samba/lib/debug.c: Remove syslog support.

2002-02-19  Pavel Roskin  <proski@gnu.org>

	* Makefile.am: Don't compile mcserv if VFS is disabled.
	* extfs/Makefile.am: Don't install anything if VFS is disabled.

	* extfs.c (extfs_open): Only create a new entry if it has not
	been found and O_CREAT is set.  Consider file as changed only
	if it has been successfully created.
	(extfs_getlocalcopy): Open file only for reading.  This prevents
	marking file as changed.  Actually use the has_changed argument.
	Reported by Nerijus Baliunas <nerijus@users.sourceforge.net>

2002-02-12  Pavel Roskin  <proski@gnu.org>

	* extfs/lslR.in: Fix parsing of old entries (with year number).
	From Daniel Skarda <0rfelyus@atrey.karlin.mff.cuni.cz>

2002-02-08  Andrew V. Samoilov  <kai@cmail.ru>

	* direntry.c (vfs_s_retrieve_file): Use off_t for total
	and stat_size.
	(vfs_s_resolve_symlink): Use snprintf instead of sprintf.

	* vfs.c (vfs_print_stats): Use off_t for have and need.
	Cast `have' to double to eliminate negative percent(s).
	Fix print_vfs_message string formats.

	* vfs.h (vfs_print_stats): Adjust declaration.

	* ftpfs.c (file_store): Use off_t for total.
	Fix print_vfs_message string format.

2002-02-07  Andrew V. Samoilov  <kai@cmail.ru>

	* ftpfs.c (dir_load): Speed up cd_first calculation.
	(ftpfs_flushdir): Resurrect.

2002-02-06  Andrew V. Samoilov  <kai@cmail.ru>

	* ftpfs.c (dir_load): Use "LIST -la" instead of "LIST -la ."
	to eliminate problem with wu-ftpd.
	Close sock on error. Eliminate goto.

	(ftpfs_chmod): Don't ignore errors.

	(reconnect): Restore cwdir if login_server fails.

2002-02-01  Andrew V. Samoilov  <kai@cmail.ru>

	* ftpfs.c (translate_path): Remove leading slash(es) more
	carefully.
	(initconn): Check getsockname() return value.
	Eliminate goto.
	(linear_abort): Make ipbuf const array.

2002-01-29  Andrew V. Samoilov  <kai@cmail.ru>

	* ftpfs.c (reconnect): New function to restore closed connection.
	(command): Use reconnect if EPIPE received.
	(dir_load): Eliminate recursion.
	(login_server): Constify netrcpass parameter.
	(is_same_dir): Constify path parameter.

	* samba/lib/charset.c (cp_850): Make const array.
	(cp_932): Ditto.
	(codepage_p): Likewise.
	* samba/lib/debug.c (priority_map): Make const array.
	* samba/lib/username.c (get_home_dir): Make pass auto.
	* samba/lib/util.c (become_daemon): Commented out.
	(yesno): Likewise.

2002-01-24  Pavel Roskin  <proski@gnu.org>

	* cpio.c: Don't include glib.h directly.

2002-01-22  Pavel Roskin  <proski@gnu.org>

	* extfs/uzip: Fix unsafe printf.
	Reported by Jari Karppinen <jakarppi@mail.student.oulu.fi>

2002-01-22  Andrew V. Samoilov  <kai@cmail.ru>

	* ftpfs.c (ftpfs_chmod): Add missed '/'.

2002-01-21  Pavel Roskin  <proski@gnu.org>

	* vfs.h: Remove all tricks with system headers, they all should
	be in global.h.
	* cpio.c: Include utilvfs.h earlier.
	* tar.c: Likewise.

	* vfs.h: Include dirent.h only if it's present.

2002-01-21  Andrew V. Samoilov  <kai@cmail.ru>

	* vfs.h: Spelled.
	* vfs.c (mc_return_cwd): Fix comment.  Check whatever mc_stat
	returns.  Make mc_return_cwd static const char *.
	Reorder if statement to eliminate unneeded mc_stat calls.

2002-01-17  Pavel Roskin  <proski@gnu.org>

	* vfs.h: Remove OS/2 specific code.

2002-01-11  Andrew V. Samoilov  <kai@cmail.ru>

	* Makefile.am (AM_CFLAGS): Add -DCONFIGDIR=\""@configdir@"\"
	if smbfs support is enabled.

	* smbfs.c (smbfs_init): Use CONFIGDIR for smb.conf.

2002-01-02  Pavel Roskin  <proski@gnu.org>

	* Makefile.am: Add *clean-local targets to take care of the
	samba directory.

	* samba/configure.in: Use explicit AC_CONFIG_AUX_DIR because
	this setting is not inherited from the top-level configure.

2001-12-31  Pavel Roskin  <proski@gnu.org>

	* Make-mc.in: convert to ...
	* Makefile.am: ... this.

	* Makefile.am: rename to ...
	* Make-alone.am: ... this.  Automake 1.5b doesn't allow Makefile
	and Makefile.am to coexist peacefully unless the former is
	generated from the later.
	* Make-mc.in: Remove all references to the standalone VFS.

2001-12-18  Pavel Roskin  <proski@gnu.org>

	* extfs/ulha.in: Support for "[unknown]" and other permissions
	in brackets.  Pass the date unchanged - mc can now deal with it.
	Use "lha lq" to list the archive and don't remove headers and
	footers of the listing.

2001-11-14  Pavel Roskin  <proski@gnu.org>

	* undelfs.c: Use ext2_ino_t to avoid warnings with e2fsprogs
	1.20 and newer.

2001-11-13  Andrew V. Samoilov  <kai@cmail.ru>

	* samba/acconfig.h: Remove WITH_SYSLOG.
	* samba/lib/system.c (sys_chroot): Removed.
	* samba/configure.in: Remove RUNPROG.  Don't check
	for chroot and execl functions.
	Remove syslog logging support.
	Add --with-codepagedir and --with-configdir from samba 2.2.2.

	* samba/Makefile.in: Use configdir and codepagedir.

2001-11-08  Pavel Roskin  <proski@gnu.org>

	* Make-mc.in (SAMBA_DIST): Remove lib/getsmbpass.c.

2001-11-05  Andrew V. Samoilov  <kai@cmail.ru>

	* smbfs.c (smbfs_add_dots): New function. Insert a "." and ".."
	entries into the linked list.
	(smbfs_loaddir): Call smbfs_add_dots for shares or servers.
	(smbfs_get_free_bucket): Eliminate time.
	(fake_share_stat): Make path const.

	* samba/configure.in: Don't check whether getpass
	should be replaced.

2001-11-02  Andrew V. Samoilov  <kai@cmail.ru>

	* vfs.c (mc_return_cwd): Memory leak fixed.

2001-11-01  Andrew V. Samoilov  <kai@cmail.ru>

	* samba/smblib/pwd_cache.c (pwd_read): Commented out.
	* samba/Makefile.in (SAMBAFILES): Remove lib/getsmbpass.o.
	* samba/lib/getsmbpass.c: Removed.

2001-10-30  Andrew V. Samoilov  <kai@cmail.ru>

	* smbfs.c: Include <config.h> before everything else.
	Don't include "tcputil.h".
	(myhostname): Declare extern.

	(loaddir): Symplify.
	(fake_share_stat): Declare server_url const.
	Use "%4o" for st_mode.
	(fake_server_stat): Likewise.  Return -1 if server_list != True.

	(get_master_browser): Declare ipzero extern.
	By David Kaelbling <drk@sgi.com>.
	http://bugzilla.gnome.org/show_bug.cgi?id=60933

	* cpio.c (cpio_read_bin_head): Release name if mc_read fails.
	(cpio_read_crc_head): Likewise.

2001-10-25  Andrew V. Samoilov  <kai@cmail.ru>

	* cpio.c (cpio_read_crc_head): Fix buffer overflow.
	(cpio_read_oldc_head): Likewise.
	By David Kaelbling <drk@sgi.com>.
	http://bugzilla.gnome.org/show_bug.cgi?id=60933

	* (cpio_read_oldc_head): Release name if mc_read fails.

2001-10-24  Andrew V. Samoilov  <kai@cmail.ru>

	* tcputil.c (rpc_get): Add missing va_end()s.
	Fix memory leaking.
	* smbfs.h: Declare smbfs_set_debug.

2001-10-20  Pavel Roskin  <proski@gnu.org>

	* ftpfs.c (command): Declare with the printf attribute.
	* undelfs.c: Remove declaration of print_vfs_message().

	* fish.c (file_store): Fix incorrect format string
	for print_vfs_message().
	* ftpfs.c (file_store): Likewise.

2001-10-19  Pavel Roskin  <proski@gnu.org>

	* fish.c (command): Declare with the printf attribute to enable
	warnings in gcc.
	(file_store): Cast all expressions with file sizes to unsigned
	long.  This should fix uploading when large file support is on.
	File size is limited to 4096 * ULONG_MAX for now.

2001-10-18  Andrew V. Samoilov  <kai@cmail.ru>

	* samba/configure.in: Don't check readline.h, history.h and
	libreadline.

2001-10-16  Andrew V. Samoilov  <kai@cmail.ru>

	* samba/libsmb/clientgen.c (cli_RNetShareEnum): Fix Win2k
	"out of server memory" error. From samba 2.0.7 patchset.

2001-10-07  Pavel Roskin  <proski@gnu.org>

	* vfs.c (vfs_parse_filetype): Fix fallback to fifo if sockets
	are not supported locally.  Support Solaris doors, also fall
	back to fifo.

2001-10-02  Andrew V. Samoilov  <kai@cmail.ru>

	* sfc.c (sfs_getid): Don't use vfs_die(), return (vfsid)(-1)
	instead.

2001-10-01  Pavel Roskin  <proski@gnu.org>

	* vfs.h [!USE_VFS]: Define macros with no effect to an empty
	statement "do { } while (0)".

2001-09-30  Pavel Roskin  <proski@gnu.org>

	* samba/acconfig.h: Only leave symbols required by Autoconf-2.52.

2001-09-17  Pavel Roskin  <proski@gnu.org>

	* vfs.c: Manually expand macros for mc_stat(), mc_lstat() and
	mc_fstat() because they don't expand correctly on Solaris 8 with
	large file support.

2001-09-10  Pavel Roskin  <proski@gnu.org>

	* Make-mc.in: Use USE_VFS conditional instead of relying on
	LIBVFS.

2001-09-07  Pavel Roskin  <proski@gnu.org>

	* Make-mc.in: Include necessary parts of Make.common to
	eliminate the later.

2001-08-23  Pavel Roskin  <proski@gnu.org>

	* names.c (finduname): Don't use HAVE_GETPWUID - it's never
	defined.  Don't redeclare getpwuid().
	(findgname): Don't use HAVE_GETGRGID - it's never defined.
	Don't redeclare getgrgid().

	* fish.c: Remove useless semicolons after functions.

2001-08-19  Pavel Roskin  <proski@gnu.org>

	* vfs.c (vfs_parse_ls_lga): Warning fix if st_nlink is unsigned.
	Disallow st_nlink = 0.

2001-08-18  Pavel Roskin  <proski@gnu.org>

	* cpio.c (cpio_read_head): Check return value of cpio_find_head,
	because it's not equal to super->u.cpio.type in case of errors.

2001-08-16  Pavel Roskin  <proski@gnu.org>

	* direntry.c (vfs_s_free_super): Remove i18n on commented out
	developer-only code.

	* extfs.c (extfs_init): Internationalize error message, it's
	already in sfs.c.

2001-08-11  Pavel Roskin  <proski@gnu.org>

	* sfs.c (sfs_init): Use g_free(), not free() on mc_sfsini.

2001-08-07  Pavel Roskin  <proski@gnu.org>

	* extfs.h: Move private structures ...
	* extfs.c: ... here.

	* extfs.h (struct entry): Remove unused `has_changed' field.
	It's only written but never read.
	(struct inode): Likewise.
	* extfs.c: All dependencies changed.
	(extfs_open): Mark file as changed if it's open for writing.

2001-08-07  Oskar Liljeblad  <osk@hem.passagen.se>

	* extfs/uzip: Update to version 1.4.0.
	* extfs/README.uzip: Likewise.

2001-08-06  Andrew V. Samoilov  <kai@cmail.ru>

	* smbfs.c: Eliminate smbfs_get_free_bucket_init.  convert_path
	gives malloced filename, so this memory must be released after use.

	(reconnect): Fix segmentation fault.
	(smbfs_loadddir): Don't g_strdup path.
	(smbfs_get_free_bucket): Eliminate smbfs_get_free_bucket_init and
	smbfs_connections initialisation.
	(smbfs_open_link): Likewise. Release host after get_master_browser.
	(get_stat_info): Fix unneeded g_strdup/g_free calls.
	(smbfs_mkdir): Release path after use.
	(smbfs_mkdir): Likewise.
	(smbfs_open): Fix memory leak.
	(smbfs_unlink): Likewise. Fix error message.
	(smbfs_rename): Fix memory leaks.
	(smbfs_stat): Fix url parsing.

	* samba/lib/charcnv.c (unix2dos_format): Fix possible buffer overflow.
	(dos2unix_format): Likewise.

	* ftpfs.c (ftpfs_fill_names): New function.
	(vfs_ftpfs_ops): Use ftpfs_fill_names insted of vfs_s_fill_names.

2001-08-03  Andrew V. Samoilov  <kai@cmail.ru>

	* utilvfs.c, vfs.h (vfs_split_url): Make path parameter const.

	* xdirentry.h (struct vfs_s_super): Remove u.ftp.result_pending field.
	* ftpfs.h (struct connection): Remove result_pending field.

	* samba/libsmb/clientgen.c (cli_chkpath): Fix possible buffer overflow.
	* smbfs.c (new_dir_entry): New function with repeated code from
	browsing_helper, loaddir_helper and server_browsing_helper.
	(browsing_helper): Use new_dir_entry.
	(loaddir_helper): Likewise.
	(server_browsing_helper): Likewise.

	(cached_lstat_info): Eliminated.
	(smbfs_readdir): Make dirent_dest static const.
	Eliminate cached_lstat_info.
	(smbfs_open_link): Make user parameter const. Fix memory leak.
	(fake_server_stat): Make path parameter const. Symplify.
	(smbfs_fstat): Set my_errno to EFAULT before return.

2001-08-01  Pavel Roskin  <proski@gnu.org>

	* Make-mc.in: Make it possible to run "make install" before
	"make all".  Use more Automake-compatible target names.

2001-08-01  Andrew V. Samoilov  <kai@cmail.ru>

	* smbfs.c: Undefine VERSION to prevent warning. Comments fixes.
	(do_connect): Symplify.
	(get_stat_info): Symplify. Eliminate another fake_stat.
	(smbfs_chdir): Release remote_dir after use.
	(smbfs_stat): Likewise. Fix another 2 memory leaks.
	(smbfs_mkdir): Release remote_file after use.
	(smbfs_rmdir): Likewise.
	(smbfs_open): Likewise. Indentation fixes.
	(smbfs_unlink): Likewise.
	(smbfs_rename): Release rb and ra after use.
	(search_dir_entry): Make text parameter const.
	(smbfs_get_host_and_username): Make macro.

2001-07-20  Pavel Roskin  <proski@gnu.org>

	* extfs.c (extfs_init) [GTK]: Use mc_home instead of LIBDIR.
	From Ludovic Drolez <ludovic.drolez@freealter.com>.

2001-07-17  Pavel Roskin  <proski@gnu.org>

	* vfs.c (mc_return_cwd): Use g_get_current_dir().

2001-07-15  Pavel Roskin  <proski@gnu.org>

	* smbfs.c: Rename authinfo to smb_authinfo and
	authinfo_get_authinfo_from_user() to vfs_smb_get_authinfo()
	and remove their definitions.
	* vfs.h: Declare smb_authinfo and vfs_smb_get_authinfo().

2001-07-10  Pavel Roskin  <proski@gnu.org>

	* extfs.c: Include contents of shared_tar_ext.c - it's no
	longer shared.
	* shared_tar_ext.c: Remove.
	* Make-mc.in (VFSSRCS): Remove shared_tar_ext.c.

	* smbfs.c (vfs_smbfs_ops): Use short name "smbfs" for the
	filesystem. Don't translate it.

2001-07-09  Pavel Roskin  <proski@gnu.org>

	* tar.c (ReadStatus): Fix compilation on AIX.
	From Dan McNichol <mcnichol@austin.ibm.com>.

	* extfs/mailfs: Strip trailing DOS newlines from mail files.
	From Christian Gennerat <christian.gennerat@vz.cit.alcatel.fr>

	* fish.c (fish_chown): Do nothing and return success if
	getpwuid() or getgrgid() fails.

2001-07-05  Pavel Roskin  <proski@gnu.org>

	* README.fish: Spelling fixes.

2001-06-29  Pavel Roskin  <proski@gnu.org>

	* Make-mc.in: Don't ever link mcserv with libintl - it must not
	depend on it.

2001-06-27  Andrew V. Samoilov  <sav@bcs.zp.ua>

	* smbfs.c: Include <config.h>. Make all internal variables static.
	(get_stat_info): Eliminate fake_stat, memory leak fixed.
	(IPC, URL_HEADER): Make static const.
	(smbfs_stat): Fix segmentation violation.
	(statfile_helper): Allocate memory for single_entry once. It is never
	freed now, and only my_stat element of this structure is used.

2001-06-26  Pavel Roskin  <proski@gnu.org>

	* vfs.h: Don't include <config.h>.

2001-06-25  Pavel Roskin  <proski@gnu.org>

	* cpio.c: Include <config.h> before everything else.
	* direntry.c: Likewise.
	* fish.c: Likewise.
	* ftpfs.c: Likewise.
	* local.c: Likewise.
	* tar.c: Likewise.
	* utilvfs.h: Don't include <config.h> - it should be included
	in all C files instead.
	* xdirentry.h: Likewise.

2001-06-19  Pavel Roskin  <proski@gnu.org>

	* local.c (local_telldir): Warn and abort if telldir() is not
	available.
	(local_seekdir): Warn and abort if seekdir() is not available.

2001-06-18  Pavel Roskin  <proski@gnu.org>

	* tcputil.c (sig_pipe): Use the same declaration with one int
	argument - it's used everywhere else and it fixes a warning on
	systems unlisted in the ifdef, e.g. OpenBSD.

2001-06-14  Pavel Roskin  <proski@gnu.org>

	* ftpfs.c: Declare functions without declarations static. Don't
	omit `void' in declarations.
	* cpio.c: Likewise.
	* direntry.c: Likewise.
	* extfs.c: Likewise.
	* mcfs.c: Likewise.
	* tar.c: Likewise.
	* vfs.c: Likewise.
	* vfs.h: Likewise.
	* mcserv.c: Likewise. Remove unused functions.

	* util-alone.c: Use indented #error.
	* vfs.h: Use indented #warning instead of hiding it from non-gcc
	compilers.

2001-06-11  Pavel Roskin  <proski@gnu.org>

	* cpio.c (vfs_cpiofs_ops): Use short name for the filesystem.
	This avoids creating long filenames in dirent.c when the "name"
	field is used.
	* extfs.c (vfs_extfs_ops): Likewise.
	* fish.c (vfs_fish_ops): Likewise.
	* ftpfs.c (vfs_ftpfs_ops): Likewise.
	* local.c (vfs_local_ops): Likewise.
	(vfs_nil_ops): Likewise.
	* mcfs.c (vfs_mcfs_ops): Likewise.
	* sfs.c (vfs_sfs_ops): Likewise.
	* tar.c (vfs_tarfs_ops): Likewise.
	* undelfs.c (vfs_undelfs_ops): Likewise.

2001-06-07  Pavel Roskin  <proski@gnu.org>

	* sfs.c (sfs_init): Change some warning messages to simplify
	their translation.

2001-06-06  Pavel Roskin  <proski@gnu.org>

	* shared_ftp_fish.c: Remove.
	* Make-mc.in: Remove shared_ftp_fish.c.
	* Makefile.am: Likewise.

2001-06-02  Pavel Roskin  <proski@gnu.org>

	* vfs.c (vfs_canon): s/canonize/canonicalize/.

2001-06-01  Andrew V. Samoilov  <sav@bcs.zp.ua>

	* ftpfs.h: Declare use_netrc, ftpfs_retry_seconds, ftpfs_first_cd_then_ls,
	ftpfs_use_passive_connections and ftpfs_use_unix_list_options.

	* vfs.c [VFS_STANDALONE]: Undefine WITH_SMBFS, they are mutually
	exclusive now.
	(is_week): Unmade week static.
	(is_month): Unmade month static.
	(vfs_parse_ls_lga): Optimize memory usage.

	* .cvsignore: *.sor added.
	* sfs.c (sfs_init): Optimized.

	* vfs/samba/lib/util_sock.c (socket_options): Made static const.

2001-05-30  Ludovic Drolez  <ludovic.drolez@freealter.com>

	* sfs.c (sfs_init): Don't hardcode location of sfs.ini,
	use mc_home to make mc relocatable.
	* util-alone.c (shell): ... here

2001-05-27  Pavel Roskin  <proski@gnu.org>

	* fish.c: Redirect stderr of all commands to /dev/null.

2001-05-25  Pavel Roskin  <proski@gnu.org>

	* sfs.c (vfs_sfs_ops): Typo fix.

2001-05-22  Pavel Roskin  <proski@gnu.org>

	* vfs.c (vfs_split_text): Fill `columns' with zeroes before
	writing new data into it.

	* fish.c (free_archive): Use `exit' instead of `logout' - the
	later fails under non-login shells.
	(pipeopen): Redirect stderr of ssh to /dev/null.
	From Rich Roth:
	(dir_load): Redirect stderr of ls to /dev/null.
	(linear_start): Likewise.

2001-05-22  Andrew V. Samoilov  <sav@bcs.zp.ua>

	* Make-mc.in (mostlyclean): Remove $(VFSSOOBJS).
	(clean): Remove *.so.

	* smbfs.c: Include utilvfs.h instead of ../config.h, ../src/main.h,
	../src/tty.h and ../src/global.h.

	(password, username): Made static.
	(is_error): Commented out.
	(loaddir_helper): Don't ignore hidden files, style fixes.
	(browsing_helper): typestr declared as char *, fstrcpy replaced by =.

	(do_connect): Call cli_shutdown () and authinfo_remove () if
	cli_session_setup () fails. It is not good idea to remember
	wrong username/password.

	(smbfs_free_dir): Nested between #ifdef SMBFS_FREE_DIR ... #endif.
	(smbfs_readdir): #ifdef SMBFS_FREE_DIR used instead of C comment.

2001-05-22  Pavel Roskin  <proski@gnu.org>

	* sfs.c (redirect): Don't free the filename after failed
	mc_mkstemps() - it's not needed anymore.

2001-05-21  Pavel Roskin  <proski@gnu.org>

	* direntry.c (vfs_s_open): Use mc_mkstemps. Create and close
	temporary file to reserve its name on the filesystem.
	(vfs_s_retrieve_file): Use mc_mkstemps().
	(g_tempnam): Remove.
	* extfs.c (extfs_open): Use mc_mkstemps().
	* sfs.c (redirect): Likewise.
	* shared_ftp_fish.c (_get_file_entry): Likewise.
	(retrieve_file): Likewise.
	* vfs.c (mc_def_getlocalcopy): Likewise.
	* xdirentry.h: Remove declaration of g_tempnam().

2001-05-18  Pavel Roskin  <proski@gnu.org>

	* vfs.c (vfs_addstamp): Rename st1 to last_stamp. Initialize it
	with NULL to suppress compiler warning.

2001-05-14  Pavel Roskin  <proski@gnu.org>

	* ftpfs.c: Warning fixes.

	* utilvfs.h: Include background.h.
	* cpio.c: Include utilvfs.h.

2001-05-14  Pavel Machek  <pavel@bug.ucw.cz>

	* Make-mc.in: add possibility to build libvfs.so

2001-04-19  Pavel Roskin  <proski@gnu.org>

	* extfs/rpm (mcrpmfs_list): Use cpio for the listing since the
	rpm output varies between versions.
	(mcrpmfs_copyout): Fix processing of CONTENTS.cpio. Match
	filenames beginning with "./" - they are used in the version 4
	packages.

2001-04-17  Pavel Roskin  <proski@gnu.org>

	* fish.c (open_archive_int): Redirect stderr of start_fish_server
	to stdout so we don't get confused if it doesn't exist.

2001-04-09  Andrew V. Samoilov  <sav@bcs.zp.ua>

	* samba/includes/proto.h, samba/libsmb/nterr.c (get_nt_error): return
	NULL when appropriative error message can't be found as it is expected
	in cli_errstr(). Return type changed to const char *

	* smbfs.c (smbfs_fill_names): implemented

	(smbfs_stat): unneeded g_strdup/g_free calls removed
	(smbfs_loaddir): memory leaking fixed

	* samba/libsmb/clientgen.c (rap_errmap, prots): constified

2001-04-06  Pavel Roskin  <proski@gnu.org>

	* Make-mc.in: Use a single variable SAMBA_DIST to hold all
	distributable samba files.

2001-03-15  Andrew V. Samoilov  <sav@bcs.zp.ua>

	* samba/libsmb/smbdes.c: undefine uchar before redefine it

	* smbfs.c (smbfs_close): honour changed semantics for return value
	(on error -1 is expected).

	* (fs): it is at least strange use char * for counter. Changed to int

2001-03-14  Pavel Roskin  <proski@gnu.org>

	* Make-mc.in: Use Automake conditional USE_SAMBA_FS.
	Remove any knowledge of SAMBAFILES. Merge object files with
	libsamba.a if USE_SAMBA_FS is true. Propagate "mostlyclean"
	to the `samba' directory. Don't ignore errors from ranlib.

	* samba/Makefile.in: Make *clean targets Automake-compatible.
	Don't ignore errors from `rm'.

	* samba/configure.in: Use AC_CHECK_TOOL to find AR.
	* samba/Makefile.in: Remove useless rules, including defunct
	dependency tracking. Create libsamba.a from the object files.

2001-03-07  Pavel Roskin  <proski@gnu.org>

	* cpio.c (cpio_skip_padding): Warning fix.
	* fish.c (dir_load): Likewise.
	* mcfs.c: Likewise.

	* extfs/uzip: New file from Oskar Liljeblad.
	* extfs/README.uzip: Likewise.
	* extfs/Makefile.am: Adjust for constant uzip.

2001-03-07  Pavel Machek  <pavel@bug.ucw.cz>

	* extfs/*uzip*: replace uzip with perl version by
	Oskar Liljeblad <osk@hem.passagen.se>

2001-03-05  Andrew V. Samoilov  <sav@bcs.zp.ua>

	* vfs.[ch] (vfs_parse_ls_lga, vfs_parse_filemode): p constified
	(vfs_strip_suffix_from_filename): filename constified
	(vfs_parse_ls_lga): memory leaking fixed when line can't be parsed,
	chomping unified

2001-03-04  Andrew V. Samoilov  <sav@bcs.zp.ua>

	* extfs/patchfs: LANG overrides LC_TIME at least in glibc,
	so use LC_ALL=C to override any locale
	* smbfs.c (smbfs_open_link): service initialized
	* (my_forget): new features of vfs_split_url used

2001-03-01  Pavel Roskin  <proski@gnu.org>

	* extfs/uzip.in (mczipfs_list): Allow filenames with colons.
	Reported by Christian Gennerat.

2001-02-28  Pavel Machek  <pavel@bug.ucw.cz>

	* vfs.c (mc_def_ungetlocalcopy): Cleanup of error handling.

2001-02-27  Pavel Machek  <pavel@bug.ucw.cz>

	* vfs.c (mc_ungetlocalcopy): Do not ignore errors. (Courtesy of
	"K. Leif D. Van Horn" <leif@kaivo.com>)

2001-02-23  Pavel Roskin  <proski@gnu.org>

	* extfs/lslR (mclslRfs_list): Don't use gawk-specific features.
	Don't hardcode gawk. Don't rely on the date format occupying a
	fixed number of fields.

	* extfs/uzip.in (mczipfs_list): Don't check zipinfo support on
	the real file - check usage info instead. Use more robust checks
	for valid lines. Suppress stderr from unzip. Workaround for jar
	files - fix mode for files ending with slash.

2001-02-20  Pavel Roskin  <proski@gnu.org>

	* vfs.h: Include sys/timeb.h if it's present. Include time.h and
	sys/time.h as recommended by Autoconf documentation.
	* cpio.c: Remove all time-related includes - they are in vfs.h.
	* extfs.c: Likewise.
	* ftpfs.c: Likewise.
	* mcfs.c: Likewise.
	* mcserv.c: Likewise.
	* tar.c: Likewise.
	* util-alone.c: Likewise.
	* vfs.c: Likewise. Include xdirentry.h.

	* extfs.c: Include xdirentry.h. Undefine ERRNOR before
	redefining it.

2001-02-19  Pavel Roskin  <proski@gnu.org>

	* shared_tar_ext.c (__find_entry): Make sure that the parent is a
	directory even if the child is not.

	* extfs/mailfs (parse_date): Correctly handle two-digit years
	between 1970 and 1999.

2001-02-14  Pavel Roskin  <proski@gnu.org>

	* vfs.c (vfs_parse_filedate): Don't reset got_year to 0 while
	checking for ctime() format.
	From Peter Daum.

2001-02-11  Pavel Roskin  <proski@gnu.org>

	* extfs/mailfs (parse_date): Workaround for Y2K bugs. Support
	for dates found in AOLMail(SM) messages. Accept single-digit
	hours and missing seconds. Provide a fallback if cannot parse
	the date.
	(process_header): Typo fix. Use \s instead of space in regular
	expressions.

2001-02-10  Pavel Roskin  <proski@gnu.org>

	* extfs/uzip.in: Preserve permissions of FAT and NTFS archives,
	including the directory bit. This fixes crashes on some FAT
	archives.

2001-02-09  Pavel Roskin  <proski@gnu.org>

	* samba/configure.in: Remove more useless tests.
	* samba/tests/crypttest.c: Remove.
	* samba/tests/fcntl_lock.c: Likewise.
	* samba/tests/shared_mmap.c: Likewise.
	* samba/tests/sysv_ipc.c: Likewise.
	* samba/samba-files: Likewise.
	* samba/smbadduser: Likewise.
	* Make-mc.in: Adjust for the above.
	* samba/include/includes.h: Removed definitions related to the
	above tests.

	* Make-mc.in: Eliminate ubiqx.
	* samba/Makefile.in: Likewise. Remove some unused variables.
	* samba/include/includes.h: Eliminate dependency on ubiqx.
	* samba/include/nameserv.h: Likewise.
	* samba/include/proto.h: Remove prototypes from nmbd/*.
	* samba/ubiqx/*: Remove.

	* samba/configure.in: More useless stuff removed.
	* samba/Makefile.in: Likewise.
	* Make-mc.in: Remove samba/smbwrapper directory.
	* samba/smbwrapper/smbw.h: Remove.
	* samba/include/includes.h: Don't include smbw.h.

	* samba/configure.in: Don't check for things that are unused.
	Remove support for building shared libraries.
	* samba/Makefile.in: Remove support for shared libraries and
	quota.

	* samba/configure.in: Don't check for any 64-bit functions and
	syscall() - they are not needed.

	* samba/configure.in: Remove the test for
	HAVE_EXPLICIT_LARGEFILE_SUPPORT, since it's incompatible with
	the rest of the source that doesn't use explicit 64-bit calls.

	* Make-mc.in: Always check for samba/Makefile before descending
	there. Don't ever ignore errors from "cd". Use $(MAKE), not
	make. Formatting changes.

2001-02-08  Pavel Roskin  <proski@gnu.org>

	* Make-mc.in: Undo previous fix. Don't run "make clean" in
	samba/ if samba/Makefile is missing.

	* Make-mc.in: Don't run "make clean" in samba/ as samba/Makefile
	may be missing. Clean using the rule from samba/Makefile.in.

	* cpio.c: Eliminate C++ comments.
	* fish.c: Likewise.

	* Make-mc.in: Use mkinstalldirs to create $(distdir)/extfs,
	since CVS Automake already creates that directory.

	* Make-mc.in: Don't add _LARGEFILE64_SOURCE to CFLAGS without
	testing - it breaks on HP-UX 10.20.

2001-02-07  Pavel Roskin  <proski@gnu.org>

	* Make-mc.in: Don't distribute samba/tests/trapdoor.c and
	samba/tests/ftruncroot.c.

	* samba/configure.in: Remove tests for setresuid and setresgid.
	* samba/include/includes.h: Remove declarations of setresuid and
	setresgid.

	* samba/configure.in: Don't check for root permissions. Don't
	call tests/trapdoor.c and tests/ftruncroot.c.
	* samba/tests/trapdoor.c: Remove.
	* samba/tests/ftruncroot.c: Likewise.
	* samba/tests/summary.c: Don't warn about trapdoor uid systems.

	* Make-mc.in: Don't link container.o into libvfs-mc.a - it's
	not used.

	* samba/aclocal.m4: Fix underquoting.
	* samba/configure.in: Fix underquoting. Don't use loff_t as the
	second argument to AC_CHECK_TYPE - it's not a builtin type.

	* samba/configure.in: Remove checks for statvfs and friends -
	they are irrelevant to the client code.
	* samba/tests/summary.c: Likewise.

2000-12-15  Andrew V. Samoilov  <sav@bcs.zp.ua>

	* extfs/urar.in (list): better solution to prevent duplication

2000-12-14  Andrew V. Samoilov  <sav@bcs.zp.ua>

	* extfs/urar.in (LC_ALL): set to C to prevent localization,
	(mcrarfs_list): directories placed first to prevent duplication

2000-10-31  Pavel Machek  <pavel@artax.karlin.mff.cuni.cz>

	* ftpfs.c (dir_load): From Roland Mainz
	<Roland.Mainz@informatik.med.uni-giessen.de>: add '.' and '..'
	directories

	* *.c: From Roland: it is not possible to g_free() something
	allocated by strdup(), because g_malloc might be different for
	malloc. Therefore wrapped strdup into g_strdup() wrapper.

2000-10-22  Andrew V. Samoilov  <sav@bcs.zp.ua>

	* samba/libsmb/nterr.c (nt_errs): constified

	* samba/libsmb/smberr.c (dos_msgs, server_msgs, hard_msgs,
	err_classes): ditto

	(smb_errstr): err constified to avoid warnings

2000-10-16  Andrew V. Samoilov  <sav@bcs.zp.ua>

	* ftpfs.c (open_data_connection): don't generate //filename, some
	ftp servers can't store it;

	(command): g_strdup_vprintf() and g_strconcat() replaced
	by g_strdup_vprintf(), g_realloc() and strcpy()
	to reduce memory usage when trailing "\r\n" added;

	(ftpfs_set_debug, ftp_data): ftp_data.logfile assigned with logfile
	value to log servers replies

2000-10-09  Andrew V. Samoilov  <sav@bcs.zp.ua>

	* sfs.c (redirect): temporary file unlinked on error;

	(sfs_init): warnings are localized

2000-10-05  Pavel Roskin  <proski@gnu.org>

	* extfs/rpm: If rpm indicates an error create a virtual file
	ERROR and put error messages there.

2000-09-25  Pavel Machek  <pavel@artax.karlin.mff.cuni.cz>

	* extfs/mcunarj.diff: better version from Christian Gennerat
	<christian.gennerat@vz.cit.alcatel.fr>

2000-09-21  Pavel Roskin  <proski@gnu.org>

	* extfs/uzoo.in: Suppress output from grep. Don't use '~',
	use $HOME instead - it's more portable.

2000-08-24  Pavel Roskin  <proski@gnu.org>

	* extfs/Makefile.am: all scripts should be executable

2000-09-18  Pavel Machek  <pavel@artax.karlin.mff.cuni.cz>

	* extfs/patchfs (LC_TIME): patch by Martin Bialasinski:
	override locale for dates

2000-09-14  Pavel Machek  <pavel@bug.ucw.cz>

	* vfs.c, extfs/{a,extfs.ini}: Improved /#a filesystem

2000-09-14  Pavel Roskin  <proski@gnu.org>

	* Make-mc.in: direntry.c was listed twice in VFSSRCS

	* Make-mc.in: removed commands to build standalone libvfs -
	they are now in Makefile.am. Create links in the build
	directory - source directory may be read-only. Removed hack
	with mcservx - it's no longer needed.

	* ftpfs.h: include "xdirentry.h" instead of "vfs/xdirentry.h"

2000-09-05  Pavel Roskin  <proski@gnu.org>

	* Make-mc.in: don't ignore errors in the distdir target

2000-08-24  Pavel Roskin  <proski@gnu.org>

	* extfs/Makefile.am: new file
	* Make-mc.in: remove stuff pertinent to the extfs directory

2000-08-24  Pavel Roskin  <proski@gnu.org>

	* Make-mc.in: don't ignore error installing mcserv.
	Create directories before installing into them.

2000-08-18  Pavel Roskin  <proski@gnu.org>

	* Make-mc.in: adjusted lists of distributed files.
	Makefile rebuilding fixed.

2000-08-08  Pavel Machek  <pavel@artax.karlin.mff.cuni.cz>

	* ftpfs.c (dir_load): taken it out, it needs to correctly provide
	parent, this way it breaks things.

	* uzip.in: change by Dmitry Borodaenko <d.borodaenko@belcaf.com> to
	display zip files in fat and ntf formats

2000-08-04  Pavel Machek  <pavel@artax.karlin.mff.cuni.cz>

	* ftpfs.c (dir_load): add . and .. to ftpfs listings, courtesy of
	Roland.Mainz@informatik.med.uni-giessen.de

	* util-alone.c (message_1s1d): added missing function

2000-08-03  Pavel Roskin  <proski@gnu.org>

	* undelfs.h: Removed

2000-08-02  Pavel Roskin  <proski@gnu.org>

	* Make-mc.in: Filters apt, audio, deba, debd and dpkg are now
	distributed. Added some comments to prevent future errors.
	"make distclean" now cleans generated filters.

	* samba/configure.in: Fixed sloppy output. The fix also sent to
	the Samba team.

	* samba/include/stamp-h.in: Added to CVS.

2000-05-23  Andrew V. Samoilov  <sav@bcs.zp.ua>

	* vfs.c (mc_[un]def_getlocalcopy): better error handling on writing

2000-05-18  Andrew V. Samoilov  <sav@bcs.zp.ua>

	* ftpfs.c: (my_get_host_and_username) space between macro name and
	  parentheses removed

2000-05-15  Andrew V. Samoilov  <sav@bcs.zp.ua>

	* tar.c (read_header): memory leaking for empty symlink's names fixed

	* utilvfs.c (vfs_split_url): *host is not assigned if host is null

	* ftpfs.c (login_server): new features of vfs_split_url () used,
	  my_get_host_and_username became macro

	* vfs.c (mc_opendir, mc_chdir): unneeded calls to concat_dir_and_file
	  removed (vfs_canon removes trailing '/')

	* sfs.c (vfmake, redirect): allocated memory realeased on errors

2000-05-10  Pavel Machek  <pavel@artax.karlin.mff.cuni.cz>

	* direntry.c (vfs_s_new_inode): Do not leave st_nlink uninitialized.

2000-05-08  Valery Kornienkov  <vlk@dimavb.st.simbirsk.su>

	vfs/extfs/uha.in: add HSC type archives

2000-05-01  Pavel Machek  <pavel@bug.ucw.cz>

	* direntry.c (vfs_s_inode_from_path): fix for stating / directory
	done properly

	* vfs.c: == 0 is right test of eof.

2000-04-28  Pavel Machek  <pavel@artax.karlin.mff.cuni.cz>

	* direntry.c (vfs_s_internal_stat): added ugly special case for /
	of archive to always exist. It seems I'm hiding some underlying
	problem :-(.

2000-04-26  Andrew V. Samoilov  <sav@bcs.zp.ua>

	* direntry.c (vfs_s_find_entry_tree): segfault fixed when root is NULL

	(vfs_s_new_inode, vfs_s_new_entry): g_new replaced by g_new0

	* ftpfs.c (dir_load): ent->name is free()d for "." and ".."

	(ftpfs_directory_timeout): default value changed to 900

	(netrc_next): "const char * const keywords" go to rodata and is shared

2000-04-16  Pavel Machek  <pavel@bug.ucw.cz>

	* vfs.c (vfs_type): FL_NO_LOCALHASH for prevention of obscure
	deadlocks with podfuk

	* direntry.c: fix behaviour when stating / directory of ftp
	archive

2000-04-15  Timur Bakeyev  <mc@bat.ru>

	* ftpfs.c (netrc_next): "const char * keywords" is pretty nice.

	* ftpfs.c (dir_load): At last, found place, that broke handling
	directories with spaces in name. Problem was in prepending "/"
	to "." for current directory. Which was, obviously, wrong. Hacked
	to make just "LIST -la ." instead.

2000-04-12  Pavel Machek  <pavel@artax.karlin.mff.cuni.cz>

	* extfs/lslR.in: Patch by tnovak@ipex.cz: allow spaces in filenames

2000-04-10  Pavel Machek  <pavel@artax.karlin.mff.cuni.cz>

	* extfs/audio: Added a way to browse audio CDs conviently

	* undelfs.c: use NULLs instead of 0s when you assign to pointers!

2000-04-05  Andrew V. Samoilov  <sav@bcs.zp.ua>

	* utilfs.c (vfs_split_url): don't assign *pass if pass is NULL
	* fish.c (archive_open, archive_same): memory allocated by
	  vfs_split_url () must be released after use, don't strdup()
	  values allocated by vfs_split_url () and NULL passed to
	  vfs_split_url () when password value is unused
	* ftpfs.c (archive_open, archive_same): ditto plus same for
	  ftpfs_get_proxy_host_and_port ()

2000-04-06  Timur Bakeyev  <mc@bat.ru>

	* ftpfs.c (netrc_next): Turned strange "const char * const keywords"
	into more alike "const char const * keywords". Still, think, it's
	too strict.

	* smbfs.c: Add #define BOOL_DEFINED before inclusion of samba headers.
	Libncurses(or slang?) defines BOOL and that can cause problems. (In fact,
	I can't find references to that const, but sure, I hade reason to do that:)

	* util-alone.h: Declare load_anon_passwd() to avoid warnings.

2000-03-31  Andrew V. Samoilov  <sav@bcs.zp.ua>

	* vfs.c (mc_def_getlocalcopy): free() replaced by g_free() to prevent
	crashes with mad, thanks to Timur I. Bakeyev <timur@bat.ru>
	* fish.c (linear_start): Name wasn't freed after usage.
	* cpio.c (cpio_ungetlocalcopy): Return type changed to int,
	function return 0 now.
	* direntry.c (vfs_s_close, vfs_s_resolve_symlink): Memory allocated
	by vfs_s_fullpath() is freed after use.
	* ftpfs.c (linear_start): Ditto.

2000-04-03  Pavel Machek  <pavel@artax.karlin.mff.cuni.cz>

	* ftpfs.c (send_ftp_command): return from vfs_s_get_path_mangle is
	not strdupped(), so it must not be g_free'd.

2000-03-29  Pavel Machek  <pavel@artax.karlin.mff.cuni.cz>

	* fish.c: Patch by <rebel@atrey.karlin.mff.cuni.cz>: make
	fish work better with files files like "this is sentence"

2000-03-28  Pavel Machek  <pavel@artax.karlin.mff.cuni.cz>

	* extfs/*rpm: Patch by <rebel@atrey.karlin.mff.cuni.cz>: set
	locale to C so that rpm does not confuse us

2000-03-06  Pavel Machek  <pavel@artax.karlin.mff.cuni.cz>

	Patch by  Andrew V. Samoilov <sav@bcs.zp.ua>

	* vfs.c (vfs_parse_ls_lga): don't hard code st_ino and st_dev to 0's,
	  these variables must be assigned in vfs_s_new_inode () or extfs
	  layer, so ftpfs subdirectories now can be copied.

2000-02-25  Pavel Machek  <pavel@artax.karlin.mff.cuni.cz>

	Patch by  Andrew V. Samoilov <sav@bcs.zp.ua>

	* vfs.[ch] (vfs_canon, mc_open, vfs_file_is_local,
	  mc_(un)?getlocalcopy): added const qualifier
	(mc_def_getlocalcopy): tempnam() returns malloc()ed buffer,
	  so, free() it, not g_free();
	(vfs_canon): prepend filename by cwd when tilde '~' cannot be expanded;

2000-02-23  Pavel Machek  <pavel@artax.karlin.mff.cuni.cz>

	* cpio.c: cpio.h is missing, so don't try to include it. (It is
	not needed, anyway. Strange.)

	* Makefile.in (NONETFILES): cpio added to compilation list

2000-02-23  Norbert Warmuth  <nwarmuth@privat.circular.de>

	* ftpfs.c: Definition of PORT changed in the middle of ftpfs.c
	with unexpected side effects (only when HSC_PROXY was
	defined). Introduce HSC_PROXY_PORT and FTP_COMMAND_PORT and use
	where appropriate.

	(dir_load): Do not hard code the directory cache timeout to 10
	seconds. Instead use the setting from Options/Virtual VFS ...

	* fish.c (file_store): honour changed semantics for return value
	(on error -1 is expected).

	* ftpfs.c (file_store): dito

2000-02-22  Pavel Machek  <pavel@artax.karlin.mff.cuni.cz>

	* cpio.c: added. Thanx to Jan Hudec <bulb@centrum.cz>, who wrote
	it using code from tarfs.

2000-02-21  Pavel Machek  <pavel@artax.karlin.mff.cuni.cz>

	* extfs/uzip.in (nam): y2k fixes (workarounds) by
	christian.gennerat@vz.cit.alcatel.fr

2000-02-04  Pavel Machek  <pavel@artax.karlin.mff.cuni.cz>

	* ftpfs.c (ftpfs_unlink, *): prepend / so that it actually works

2000-02-03  Andrew V. Samoilov  <sav@bcs.zp.ua>

	* xdirentry.h: added prototype for vfs_s_retrieve_file

2000-01-31  Andrew V. Samoilov  <sav@bcs.zp.ua>

	* direntry.c: (vfs_s_resolve_symlink, vfs_s_readlink) fixed segfaults
	for broken symlinks like 2001 -> The Space Oddysea.

2000-01-24  Pavel Machek  <pavel@artax.karlin.mff.cuni.cz>

	* ftpfs.c: vfs semantics has some problems with ~s. What will
	happen if we just don't go to home directory of user? (We used to
	have /#ftp:hobit/~/ mean home directory of anonymous at
	hobit. Thats pretty broken.)

	* direntry.c (vfs_s_find_entry_linear): don't sleep after showing
	message

	* ftpfs.c: cosmetic fixes by Andrew V. Samoilov

2000-01-18  Pavel Machek  <pavel@artax.karlin.mff.cuni.cz>

	* ftpfs.c: cosmetic fixes + killed ugly infinite loop, patch
	from Andrew V. Samoilov

2000-01-13  Pavel Machek  <pavel@artax.karlin.mff.cuni.cz>

	* extfs.c (extfs_chdir): removed unneeded statment, plus applied
	cosmetics fixes from Andrew V. Samoilov

2000-01-02  Martin Bialasinski  <martin@internet-treff.uni-koeln.de>

	* extfs/deb.in: Change to the deb vfs. tar has changed, and
	depending on the version, it saves files as "./filename" or
	"filename".

	* From debian: added deba, debd, dpkg, apt script file systems.

1999-12-28  Andrew V. Samoilov  <sav@bcs.zp.ua>

	* vfs.c (vfs_parse_filedate): don't decode last columns as year


1999-12-21  Pavel Roskin  <pavel_roskin@geocities.com>

	* vfs/vfs.h: use #warning only for gcc. Not all compilers
	understand it

1999-12-15  Pavel Machek  <pavel@artax.karlin.mff.cuni.cz>

	* Merged changes by Andrew V. Samoilov <sav@bcs.zp.ua>. They are
	mostly internationalization + fixing stupid bugs of mine

1999-12-08  Pavel Machek  <pavel@artax.karlin.mff.cuni.cz>

	* ftpfs.c: basically replaced ftpfs with new one. Unlike the
	previous one, this uses new direntry.c layer, so shared_ftp_fish.c
	can be killed.

	This is new code, so beware.

1999-11-11  Pavel Machek  <pavel@artax.karlin.mff.cuni.cz>

	* shared_ftp_fish.c (s_ungetlocalcopy): need to supply some return
	value, too. This code is going to be killed, the sooner the better.

	* *.c (mc_[un]getlocalcopy): we really need some return value,
	because we can have errors

	* fish.c: don't use directory expiration, it does not work,
		use retrieve_file from direntry.c


1999-02-17  Pavel Machek  <pavel@bug.ucw.cz>

	* direntry.c (vfs_s_getlocalcopy): fixed segfault, getlocalcopy's
	name has to be malloced.

1999-10-07  Miguel de Icaza  <miguel@gnu.org>

	* ftpfs.c (linear_read): Applied patch from Alexander V. Lukyanov
	<lav@yars.free.net> that makes the code compliant to RFC959

1999-08-30  Miguel de Icaza  <miguel@gnu.org>

	* ftpfs.c (insert_dots): Use g_new here.

	* shared_ftpfs_fish.c: Style fixes and small fixes

1999-09-22  Bjorn Eriksson  <mdeans@algonet.se>

	* extfs/uzip.in: Better handling of zip-archives that contain files
	which contain spaces.

1999-09-19  Norbert Warmuth  <nwarmuth@privat.circular.de>

	* ftpfs.c (ftpfs_set_debug), vfs.h: added const qualifier.

	* mcserv.c: removed definition of mad_strconcat which is also
	in mad.c.

1999-09-17  Federico Mena Quintero  <federico@redhat.com>

	* smbfs.c: #define NO_CONFIG_H before including the samba
	includes; this way it will not re=define HAVE_LIBREADLINE.  This
	situation sucks.  Should we change the names of the widget.h
	history_*() functions?

1999-09-14  Norbert Warmuth  <nwarmuth@privat.circular.de>

	* smbfs.c (various places): Store filenames in memory with the unix
	character set and convert it back to the dos character set when
	filenames are passed back to the samba server. If samba is configured
	correctly this will fix the problems with filenames which contain
	national characters.

	(bucket_set_authinfo): Set domain, username and password which will
	be used to log on and authenticate against the samba server and remember
	this information on a host/share basis. If set use PASSWD to get the
	password. If already authenticated against the host and share use this
	information. If already authenticated against host and IPC$ use this
	information. If neither of the former is true ask the user how to
	log on.

	(authinfo_get_authinfo_from_user): New function. Query the user for
	domain, username and password to use for authentication.

	(authinfo_free): New function. Free memory in authentication structure.

	(authinfo_free_all): New function. Free the list used to remember
	authentication information.

	(authinfo_compare_host_and_share, authinfo_compare_host): New functions.
	Helper functions used to search the authentication list.

	(authinfo_add): New function. Add one authentication entry to the
	authlist.

	(authinfo_remove): New function. Remove one entry from the authlist.

	(free_bucket): Free memory associated with one bucket.

	(smbfs_get_free_bucket): Initialize the complete connection array
	with 0. Free the memory allocated for a bucket and initialize the
	bucket before reusing it.

	(smbfs_open_link): use new functions to get authentication information

	(get_stat_info, smbfs_stat): remove unused variables.

1999-08-31  Federico Mena Quintero  <federico@redhat.com>

	* extfs/uzip.in: Handle filenames with spaces better.  Thanks to
	Spyridon Papadimitriou <Spyridon_Papadimitriou@gs91.sp.cs.cmu.edu>
	for the patch.

1999-08-30  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* ftpfs.c (translate_path): Remove static buffer from here.
	Return a strdupped string now.
	(send_ftp_command): Release translate_path result here.
	(open_data_connection): Release translate_path result here.
	(ftpfs_chdir_internal): Reease it here too.

1999-08-30  Norbert Warmuth  <nwarmuth@privat.circular.de>

	* shared_ftp_fish.c (get_line): Fixed off by one error ('\0' might
	have been written one slot past the supplied character array).

	* ftpfs.c (resolve_symlink_without_ls_options): Don't dump core on
	strange symlinks (ls -la doesn't reveal where the symlink points to
	and ls -lLa doesn't resolve the symlink either)

	Added protection against recursive symbolic links.

1999-08-19  Norbert Warmuth  <nwarmuth@privat.circular.de>

	* smbfs.c: added missing include file

	(browsing_helper): use g_strdup instead of g_new + pstrcpy
	(Btw. this is an example why the handholding of smblib gives a
	false security feeling. pstrcpy limits the number of characters
	copied and is used with a buffer which is smaler than the hard
	coded limit in pstrcpy)
	(loaddir_helper): ditto
	(server_browsing_helper): ditto

	(get_remote_stat): fixed memory leaks
	(smbfs_loaddir): ditto
	(get_stat_info): ditto
	(smbfs_stat): ditto

	(convert_path): rewritten, now it's much cleaner what it does.
	This rewrite was necessary because gcc -O2 choked on glibc 2.1
	systems. In that combination strncat is a macro which expands to
	strlen and strcat and in vfs/samba/include/includes.h the latter is
	defined to __ERROR__XX__NEVER_USE_STRCAT___;.

1999-08-18  Norbert Warmuth  <nwarmuth@privat.circular.de>

	* direntry.c (vfs_s_getlocalcopy): There's an aditional strdup
	needed. In rare cases a pointer was freed twice. Pavel Machek
	pointed this out a while ago but obviously it hasn't been fixed yet.

	* sfs.c (vfmake): Quote characters with a special meaning to the
	shell in filenames/-pathes (Fix Bug #1931, VFS will not work if
	your full path has the space character in it.).

1999-08-17  Kjartan Maraas  <kmaraas@online.no>

	* fish.c: Fix typo.

1999-08-15  David Martin  <dmartina@usa.net>

	* vfs.c (vfs_print_stats): Translate vfs stats

	* shared_ftp_fish.c (s_read, s_lseek): Mark strings for translation

	* fish.c: Translate messages

1999-08-06  Norbert Warmuth  <nwarmuth@privat.circular.de>

	* tar.c (read_header): Don't segfault when a symlink points to the
	root directory.

1999-08-01  Norbert Warmuth  <nwarmuth@privat.circular.de>

	* vfs.c: Don't close a function definition with "};". SunCC from
	2.5.1 chokes on the extra semicolon

	(mc_munmap): Don't dereference function pointer when checking for
	NULL (this check is supposed to prevent a segfault instead of
	causing one). This haven't got noticed up to now becaue there's no
	file system with mmap but without munmap.

Tue Jul  6 11:22:40 1999  Timur I. Bakeyev  <mc@bat.ru>

	* samba/include/config.h: Removed. Should be generated.

Tue Jul  6 11:18:45 1999  Timur I. Bakeyev  <mc@bat.ru>

	* Make-mc.in(XCPPFLAGS): Add necessary paths to allow compile sambafs
	when builddir != srcdir. Removed some junk after not coherent patching.

1999-07-04  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* Make-mc.in (distcopy): Added a bunch of new lists of files for
	the directories in vfs/samba.  Use them in this rule, because
	plain wildcards will not work right.
	(SAMBA_DIST_TOPLEVEL): Added configure to the list of distributed
	files.
	Added smbfs.[ch] to the list of sources.

1999-07-02  Tuomas J. Lukka  <lukka@iki.fi>

	* Make-mc.in: $SAMBAFILES -> @SAMBAFILES@ in the rule
	as well as the dependencies.

1999-06-25  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* smbfs.c 	(get_remote_stat): Change debug level.

	(get_stat_info): 2 line fixes from Wayne to check the
	cache properly.  WOOOOHOOOO!  Works like a charm.

1999-06-14  Wayne Roberts  <wroberts1@cx983858-b.orng1.occa.home.com>

	* vfs/smbfs.c: New file.  Implements the Samba-based file system.

	* vfs/vfs.h: Declare vfs_smbfs_ops, vfs_file_is_smb.

	* vfs/vfs.c (vfs_file_is_smb): implemented.
	(vfs_init) register smbfs.

	* vfs/samba: Incorporate SAMBA source code required for smbfs

Fri Jun 18 11:49:05 1999  Norbert Warmuth  <nwarmuth@privat.circular.de>

	* ftpfs.c (resolve_symlink_with_ls_options): Some ftp servers don't
	make a difference between "LIST -la" and "LIST -lLa". If we find such
	a server don't use -lLa when resolving symbolic links.

1999-05-12  Christian GENNERAT  <christian.gennerat@alcatel.fr>

	* urar.in, uzip.in: patches to use in #urar and #uzip the new features
	added in mc-4.5.31 (unlink, mkdir, rmdir)

1999-04-30  Pavel Machek  <pavel@artax.karlin.mff.cuni.cz>

	* extfs/deb.in (mcdebfs_run): Quote string properly, fix suggested
	by debian mantainer

1999-04-25  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* extfs/uzip.in (nam): Handle new unzips.

Fri Apr 23 21:02:32 1999  Norbert Warmuth  <nwarmuth@privat.circular.de>

	* ftpfs.c (retrieve_dir): If we don't get any valid directory entry
	(i.e. not even "." and "..") check whether the directory is empty
	or not existend (instead of failing with "ftpfs: failed").

1999-04-23  Pavel Machek  <pavel@artax.karlin.mff.cuni.cz>

	* vfs.c (vfs_parse_filemode): fix for solaris which uses 'l'
	instead of 'S'.
	(vfs_parse_ls_lga): do not silently ignore parsing errors.

Wed Apr 21 21:59:50 1999  Norbert Warmuth  <nwarmuth@privat.circular.de>

	* extfs.c (extfs_open): tempnam returns a malloced string, no need
	to strdup it

	(various places): use free instead of g_free to free string returned
	by tempnam.

1999-04-21  Pavel Machek  <pavel@artax.karlin.mff.cuni.cz>

	* urar.in, uzip.in: rolled in patches from "christian.gennerat"
	<christian.gennerat@vz.cit.alcatel.fr> for better handling of
	spaces and copyin-feature-addon.

1999-04-18  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* extfs.c (get_path_from_entry): Fix a crash here.

1999-04-12  Andrew T. Veliath  <andrewtv@usa.net>

	* extfs.c (extfs_unlink):
	(extfs_mkdir):
	(extfs_rmdir):
	(remove_entry): New functions.
	(vfs_extfs_ops): Add unlink, mkdir and rmdir functions to table.
	Add descriptions for these to the extfs README.

1999-04-12  Pavel Machek  <pavel@artax.karlin.mff.cuni.cz>

	* Make-mc.in (DISTVFS): try to distribute files needed for
	building libvfs.so alone
	(EXTFS_MISC): include uarj and unarj.diff in distribution

1999-04-08  Owen Taylor  <otaylor@redhat.com>

	* extfs/deb.in extfs/ulha.in extfs/ucpio.in: Fix
	up "TMP RACE" comments so they are at least secure,
	if not terribly robust.

1999-03-31 Serge Winitzki  <swinitzk@hotmail.com>

	* added copy_in capability to mtools filesystem

1999-03-30  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* vfs.c (vfs_add_current_stamps): Only do stamping of the panels
	if they exist.

	* mcserv.c: #include <sys/wait.h>
	(get_client): Put `#ifdef __EMX__' around an otherwise-unused
	variable.

	* utilvfs.c (vfs_split_url): Fix NULL <-> 0 confusion when
	comparing characters.

	* ftpfs.c (retrieve_dir): Removed unused variable dot_dot_found.

	* extfs.c (extfs_init): Assign `key' to c, not `&key'.

Sun Mar 28 23:50:47 1999  Norbert Warmuth  <nwarmuth@privat.circular.de>

	* vfs.h (vfs_translate_url): Fixed the macro which is used when
	compiling without vfs.

1999-03-22  David Martin  <dmartina@mailexcite.com>

	* ftpfs.c: Internationalize the messages that are displayed as
	hints.

1999-03-22  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* extfs.c (extfs_init): Fix the code here:  If the key is empty or
	only contains a new line, C would be pointing into an invalid location.

Mon Mar 22 02:56:23 1999  Timur I. Bakeyev  <mc@bat.ru>

	* Makefile-mc.in: s/$(libdir)\/extfs/$(extfsdir)/

Mon Mar 22 02:00:16 1999  Valery Kornienkov  <vlk@st.simbirsk.su>

	* extfs/uha.in: Add support for ha archives.

1999-03-12  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* vfs.c (vfs_parse_ls_lga): Handle stupid servers that send n_link
	set to zero.

1999-03-11  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* vfs.h: Make it compile in AIX.  Boy do those guys polute the
	name space.

1999-03-09  Shooby Ban  <bansz@szif.hu>

	* extfs/extfs.ini: Corrected rpms -> rpms:
	by Balazs Nagy <julian7@kva.hu>

1999-03-09  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* vfs.c (parse_ls_lga): kill the messages on each error.

Tue Feb 16 12:11:04 1999 Paul Sheer  <psheer@obsidian.co.za>

	* mcserv.c, mcfs.c: mcserv and mcfs exchange st_dev instead
	of st_rdev. This makes stats on device files useless. Fixing
	this does not break anything, but adds the ability to copy
	device files properly. Ideally, both st_dev and st_rdev should
	be returned for those programs that use the vfs to properly
	recreate hardlinks. Whose idea was it to only return one of
	these???

1999-02-12  Sergey Korshunoff  <seyko@p5.f434.n5020.z2.fidonet.org>

	* unlha.in: Fix the problem of having incorrect pathnames when
	pulling out files from the LHA file.

Sat Feb  6 23:44:28 1999  Norbert Warmuth  <nwarmuth@privat.circular.de>

	* tar.c (read_header): Treat hardlinks correctly.

Mon Feb  1 19:32:12 1999  Norbert Warmuth  <nwarmuth@privat.circular.de>

	* ftpfs.c (insert_dots): renamed from insert_dot. We have to
	insert ".." as well or directories from ftp servers which don't
	list "." and ".." are displayed with an additional "/".

Mon Feb  1 02:55:07 1999  Timur I. Bakeyev  <mc@bat.ru>

	* tcputil.c: One more my bug with '\0' -> NULL. Oops..

Mon Feb  1 01:45:08 1999  Timur I. Bakeyev  <mc@bat.ru>

	* mcserv.c: If setuid() is avaliable, use it, even, streuid() also
	present. (BTW, bsdi uses it's own auth system..)

Sun Jan 31 20:51:17 1999  Alexander Savelyev  <fano@vcom.kiev.ua>

	* mcserv.c (do_auth): mcserv never auth properly on bsdi.
	(mc/vfs/mcserv.c do_auth() on bsdi we must use setuid() not
	setreuid()).

	* tcputil.c: use correct signal handler (void func(int)) on BSDI

Sun Jan 31 20:41:00 1999  Norbert Warmuth  <nwarmuth@privat.circular.de>

	* mcserv.c (do_link): Removed duplicate invokation of link. Thanks
	to Grzegorz Makarewicz <mak@mikroplan.com.pl> for spotting this.

Sun Jan 31 20:04:13 1999  Norbert Warmuth  <nwarmuth@privat.circular.de>

	* vfs.c (vfs_strip_suffix_from_filename): Whoever replaces every
	occurance of 0 with NULL should stop this stupidy. And replacing
	'\0' with NULL is plan wrong!!. Reverted this replacement.

	* ftpfs.c (load_no_proxy_list): ditto

Sun Jan 31 19:57:24 1999  Norbert Warmuth  <nwarmuth@privat.circular.de>

	* ftpfs.c (insert_dot): New function. Insert a "." into the linked
	list. Stat'ing the root directory of a ftpfs fails if the dot is
	missing.

	(retrieve_dir): insert "." into the linked list if the ftp server
	haven't send it.

Sun Jan 31 19:50:24 1999  Norbert Warmuth  <nwarmuth@privat.circular.de>

	* The following changes make ftpfs work with a remote AmiTCP
	server are the result of somehow longish EMail debugging session. I
	don't know any public server of this kind but I was told the
	combination Unix/Amiga boxes are often used in intranets.

	* ftpfs.c (translate_path): New function. Translate a Unix path,
	i.e. MC's internal path representation (e.g. /somedir/somefile) to
	a path valid for the remote server. Every path transfered to the
	remote server has to be mangled by this function right prior to
	sending it. Currently only Amiga ftp servers are handled in a
	special manner.

	* ftpfs.c (various places): use translate_path

	* ftpfs.c (login_server): Assume we have to mangle pathnames if
	the greatings string from the server contains the word Amiga. If
	this assumption is wrong I have to find another way to turn on
	path translation.

	* ftpfs.c (ftpfs_get_current_directory): Prepend a leading slash
	if it is missing. MC needs it as seperator between hostname and
	path in its internal url representation.

1999-01-26  Pavel Machek  <pavel@artax.karlin.mff.cuni.cz>

	* vfs.c (vfs_parse_ls_lga): attempt to correctly work against
	Notwell 4

Wed Jan 27 03:09:48 1999  Timur I. Bakeyev  <mc@bat.ru>

	* All around the source: Changed copy_strings() to g_strconcat(). Modi-
	fy last parameter in concat_dir_and_file() to "" - to prevent stack from
	disbalancing.

1999-01-25  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* Makefile.am (libvfs_la_SOURCES): Added utilvfs.h.
	* Make-mc.in (VFSHDRS): Likewise.

Sat Jan 23 18:40:19 1999  Timur I. Bakeyev  <mc@bat.ru>

	* utilvfs.c (append_path_sep): Removed - concat_dir_and_file(dir, NULL);
	gives the same effect.

1999-01-21  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* utilvfs.c (append_path_sep): Fixed, it was broken for paths
	which already have a / at the end.

Fri Jan 22 01:41:25 1999  Timur I. Bakeyev  <mc@bat.ru>

	* undelfs.c: Found one more unconverted realloc() call.

1999-01-20  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* undelfs.c (undelfs_loaddel): Fix Timur's changes.

Thu Jan 21 00:58:12 1999  Timur I. Bakeyev  <mc@bat.ru>

	* Actually commit all changes :>

Tue Jan 19 05:15:49 1999  Timur I. Bakeyev  <mc@bat.ru>

	* Converted all occurences of DIR_SEP_CHAR and "/" to PATH_SEP and
	PATH_SEP_STR. Additionall cleanups of the memory code.

	* utilvfs.h: Added several defenitions for common sizes for buffers.
	It seems, most of us experience problems, when inventing size for new
	buffer. This is much better and portable way to eliminate the problem.

1999-01-18  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* vfs.h: The correct thing to use is PATH_SEP and PATH_SEP_STR

Sun Jan 17 16:19:48 1999  Timur I. Bakeyev  <mc@bat.ru>

	* Converted memory managment to Glib. Now we use g_new()/g_malloc()/
	g_strdup()/g_free() routings. Also, copy_strings() replaced by
	g_strconcat(), and sprintf() by g_snprintf().

	* utilvfs.h: New header file. Introduced as a stock header, which keeps
	all includes in a right order, to avoid order-dependence mistakes.

Sun Jan 17 15:49:39 1999  Paul Sheer  <psheer@obsidian.co.za>

	* direntry.c: vfs_s_find_entry_tree changed to follow
	symlinks properly. Symlinks are now always followed
	except for the last part of the filename.
	vfs_s_resolve_symlink() now converts absolute paths to
	../../file notation so that they can be easily resolved
	within the tree.

	* tar.c: . and .. are missing from directory entries,
	making it impossible to resolve links - fixed.

1999-01-12  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* vfs.c (mc_get_current_wd): Do not die.  Truncate the pathname.

1999-01-10  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* sfs.c (redirect): tempnam returns a malloc()ed buffer.

Sat Jan  9 19:15:00 1999  Norbert Warmuth  <nwarmuth@privat.circular.de>

	* vfs.c (vfs_timeout_handler): Guard from recursive invocation.

Sat Jan  9 19:13:28 1999  Norbert Warmuth  <nwarmuth@privat.circular.de>

	* sfs.c (sfs_free): Fixed wrong linked list handling (head was
	lost after the first iteration).

	(sfs_getid): dito, return value was wrong.

Sat Jan  9 22:49:02 1999  Timur I. Bakeyev  <mc@bat.ru>

	* vfs.c (parse_ls_lga): Rewrite function to make it more stright.
	Also, fixed some bugs in parsing (and add new ones:), which diasallowed
	proper parsing of device major and minor numbers. Some other fixes. Add
	several new is_*() functions to make code readable.

1999-01-08  Ilya Zakharevich  <ilya@math.ohio-state.edu>

	* vfs.h (vfs_strip_suffix_from_filename): Typo fix.  Include
	defines for non-vfs compilation.

Fri Jan  8 20:03:36 1999  Andrej Borsenkow  <borsenkow.msk@sni.de>

	* vfs.c (vfs_parse_filedate): I forgot to set got_year in one place
	(where YY-MM-DD is parsed).

Thu Jan  7 06:24:25 1999  Andrej Borsenkow  <borsenkow.msk@sni.de>

	* vfs.c (vfs_parse_filedate): If the date is less than 6 months
	in the past, it is shown without year. In this case MC assumed
	the current year which is wrong from Jan to Jun.

Thu Jan  7 03:47:35 1999  Timur I. Bakeyev  <mc@bat.ru>

	* vfs.c (parse_ls_lga): Fixed Y2K typo pointed by Alex.

Thu Dec 31 08:47:15 1998  Norbert Warmuth  <nwarmuth@privat.circular.de>

	* sfs.c (sfs_nothingisopen): Assume for now it's always save to free
	this filesystem and delete temporary files. This needs further
	investigation.

	* tar.c: deleted unused empty struct tar_super.

Thu Dec 31 08:40:44 1998  Norbert Warmuth  <nwarmuth@privat.circular.de>

	* direntry.c: Split fd_usage into fd_usage and ino_usage. fd_usage
	was used for external and internal reference count. This was wrong
	because we can free resources taken up by the vfs as soon as the
	external reference count (now fd_usage) is zero. The internal
	reference count (ino_usage) mustn't matter because the vfs has to
	clean up itself in the correct order.

Fri Dec 25 21:48:51 1998  Norbert Warmuth  <nwarmuth@privat.circular.de>

	* direntry.c (vfs_s_new_inode): Moved initialization of st_ino
	and st_dev from vfs_s_default_stat.

	(vfs_s_default_stat): initialize st_ino and st_dev to zero

	* tar.c (tar_open_archive): Make a new MEDATA->rdev for every
	new archive.

Mon Dec 21 22:55:48 1998  Norbert Warmuth  <nwarmuth@privat.circular.de>

	* tar.c: Deleted global variable tar_gzipped_memlimit.

Wed Dec 16 06:36:42 1998  Norbert Warmuth  <nwarmuth@privat.circular.de>

	* vfs.c (vfs_strip_suffix_from_filename): New function which strips
	known vfs suffixes from a filename and returns a malloced string
	which has to be freed. Possible improvement: strip vfs suffix from
	last path component.

	* extfs/*: added "umask 077" to every script.

Tue Dec 15 16:41:50 1998  Pavel Machek  <pavel@atrey.karlin.mff.cuni.cz>

	* extfs.c (extfs_open), sfs.c (redirect): create files 0600 and
	safely w.r.t. symlinks in /tmp

Mon Nov 30 23:49:11 1998  Pavel Machek  <pavel@bug.ucw.cz>

	* direntry.c: Hopefully got want_stale_data right...

Wed Nov 25 23:54:23 1998  Pavel Machek  <pavel@bug.ucw.cz>

	* vfs.h: use ENETUNREACH if EREMOTEIO error code is not defined,
	this is neccessary for Solaris and probably others

Mon Nov 23 17:39:33 1998  Pavel Machek  <pavel@bug.ucw.cz>

	* vfs.c (vfs_type_from_op): removing unneccessary code

Wed Dec  9 12:24:52 1998  Pavel Machek  <pavel@atrey.karlin.mff.cuni.cz>

	* extfs/rpm: commit fix for files with spaces in name by Marc
	Merlin (marcsoft@merlins.org)

Mon Dec  7 11:04:57 1998  Pavel Machek  <pavel@atrey.karlin.mff.cuni.cz>

	* fish.c: default to normal ssh
	(open_archive_int): debugging hack killed

1998-12-02  Raja R Harinath  <harinath@cs.umn.edu>

	* Makefile.am (EXTRA_DIST): Distribute files that the
	BUILT_SOURCES depend on.
	(mad.c, mad.h): Don't use GNU make specific features in rule.
	(libvfs_la_SOURCES): Update from Make-mc.in.

1998-12-02  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* direntry.c (vfs_s_insert_super): This routine does not return
	anything.

1998-12-02  Sebastian Wilhelmi  <wilhelmi@ira.uka.de>

	* fish.c (FISH_OP): changed snprintf to g_snprintf, as glib is
	used anyway.

	* xdirentry.h (LINK_NO_FOLLOW):
	* tar.c (read_header):
	* direntry.c (vfs_s_resolve_symlink):
	(vfs_s_inode_from_path):
	(vfs_s_open): renamed NO_FOLLOW and FOLLOW to LINK_NO_FOLLOW and
	LINK_FOLLOW resp. to avoid problems on solaris, where FOLLOW and
	NO_FOLLOW are defined in an enum.

	* vfs.h (ELAST): define it to 300, if not already defined, thats a
	bad hack, but what can we do....

Wed Dec  2 14:06:49 KST 1998  Sung-Hyun Nam  <namsh@lgic.co.kr>

	* direntry.c (vfs_s_new_super): Added the missing return value.

Sun Nov 29 02:54:54 1998  Timur I. Bakeyev  <mc@bat.ru>

	* vfs.h: (Temporary?) fix to the compiling error: Some of the error
	codes, defined here are Linux specific and unknown to other systems.
	Changed to #ifdef's with assigning new codes by means ELAST+offset.

Tue 24 Nov 12:43:20 1998  Peter Kleiweg  <kleiweg@let.rug.nl>

	* vfs.c (vfs_parse_ls_lga): ignore trailing + in permission string
	which indicate a file with extented attributes (ACL)

Mon Nov 23 21:19:43 1998  Norbert Warmuth  <nwarmuth@privat.circular.de>

	* ftpfs.c (resolve_symlink_with_ls_options): that's resolve_symlinks
	we used up to release 4.1.35. It uses LIST -lLa to get symlink stats.

	(resolve_symlink_without_ls_options): that's resolve_symlinks
	we used in release 4.1.36 and 4.5.[01]. It gets symlink stats from the
	directory cache fetching directories if necessary. We got some
	complaints about slower ftpfs in the above releases. Now this methode
	is no longer the default methode to resolve symbolic links. It is still
	needed for ftp servers which don't understand the LIST -lLa command.

	(resolve_symlink): Dispatch between the two methods to
	resolve symlinks.

Sat Nov 21 21:38:08 1998  Pavel Machek  <pavel@bug.ucw.cz>

	* vfs.c (vfs_parse_ls_lga): corrected stupid bug in parse_ls_lga,
	thanks to Pavel Roskin for reporting

	* direntry.c (vfs_s_lseek): -1 is invalid filehandle, not 0

	* utilvfs.c (vfs_split_url): initialize variables so that we do
	not return garbage

Sat Nov  7 20:19:14 1998  Pavel Machek  <pavel@bug.ucw.cz>

	* vfs.c: Converted g_return_if_fail into vfs_dies(), removed them
	where unneccessary. I do not see why passing NULL to vfs_add_stamp
	should be invalid -> removed check.

Mon Nov  2 23:09:55 1998  Pavel Machek  <pavel@bug.ucw.cz>

	* direntry.c, xdirentry.h: should be now prepared to handle
	ftp-like filesystems. This is rather BIG change, altrough it does
	not look so. I hope I do not break too many things.

Mon Nov 16 16:39:39 1998  Pavel Machek  <pavel@atrey.karlin.mff.cuni.cz>

	* vfs.c (vfs_parse_ls_lga): Report unrecognized lines.

Thu Nov 12 11:28:48 1998  Pavel Roskin  <pavel_roskin@geocities.com>

	* extfs/rpm: Fix to display files belonging to users with
	excessively long usernames

1998-10-30  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* fish.c (command): Replace vnsprintf with g_strdup_vprintf.  This
	is both safe and more correct, as there is no limit on the
	pathname.

	* ftpfs.c (command): Same as above.

	* util-alone.c (print_vfs_message): Same as above.

Wed Oct 28 17:06:57 1998  Pavel Machek  <pavel@atrey.karlin.mff.cuni.cz>

	* ftpfs.c: report which directory you are listing, fix behaviour
	with servers that don't like LIST //. (Nowell) Fix behaviour even
	with NT.

	* direntry.c (vfs_s_automake): insert newly generated entry

	* direntry.c (vfs_s_free_entry): Debugging printf() killed.

Mon Oct 26 00:38:30 1998  Norbert Warmuth  <nwarmuth@privat.circular.de>

	* Make-mc.in: added xdirentry.h to VFSHDRS

Fri Oct 23 12:29:48 1998  Pavel Machek  <pavel@atrey.karlin.mff.cuni.cz>

	* tar.c (tar_open_archive): do not double-free memory if you can
	not open archive, better error handling

	* Makefile.in: add direntry.o to list of NONETFILES so we actually compile

	* sfs.c, tar.c: remove debugging messages (which really should not
	escape from my tree)

Thu Oct 22 22:24:44 1998  Pavel Machek  <pavel@bug.ucw.cz>

	* README: added. If you are using emacs or hacking libvfs, please
	read this one.

	* direntry.{c,h}: new library created, so that same entry/inode
	code does not have to be copied in every handler.

	* tar.c: converted to use direntry.c library, which means BIG changes.

	* ftpfs.c: small updates to make code look nicer

Mon Oct 19 19:40:58 1998  Pavel Machek  <pavel@bug.ucw.cz>

	* vfs.h (&more): killed ERRNOR() from vfs.h and put it into files
	which actually need it.

	* extfs.c: extfs_current_dir killed - it was unneccessary.

	* mcfs.c (mcfs_get_path): It is possible for path not to begin
	with /#mc:, for example if user does /etc/#mc:. (It is not
	correct, of course). Return error, but do not vfs_die().

Sun Oct 18 23:48:00 1998  Pavel Machek  <pavel@bug.ucw.cz>

	* lib/mc.ext.in: cpio support fixed. It was broken since time we
	started to do #ext syntax.

Sat Oct 17 20:43:20 1998  Pavel Machek  <pavel@bug.ucw.cz>

	* vfs.c (mc_open): die() if open is unsupported. If filesytem does
	not support open, it is probably stupid typo, so we want bug to be
	fixed.

Thu Oct 22 20:30:28 1998  Norbert Warmuth  <nwarmuth@privat.circular.de>

	* ftpfs.c (resolve_symlink, retrieve_dir): Don't timeout and
	free dcache while resolving symlinks (i.e. don't free some
	pointers which are in use by resolve_symlink).

Mon Oct 19 11:44:47 1998  Pavel Machek  <pavel@atrey.karlin.mff.cuni.cz>

	* mcfs.c: prefix is mc:, not mcfs:. So now mcfs actually works.

Thu Oct 15 17:17:17 1998  Pavel Machek  <pavel@atrey.karlin.mff.cuni.cz>

	* shared_ftp_fish.c (s_write): stupid bug fixed

Tue Oct 13 00:22:52 1998  Pavel Machek  <pavel@bug.ucw.cz>

	* extfs/*: marked obvious security holes with FIXME: TMP RACE

	* vfs.c (mc_def_getlocalcopy): creat->open(..,O_EXCL), to prevent
	symlink attack, fixed memory leak along the path

1998-10-13  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* vfs.c, vfs.h: Indentation chages, ugly macros removed.  I am
	going to split this file in the future.

Tue Oct 13 18:43:18 1998  Pavel Machek  <pavel@lomikel.karlin.mff.cuni.cz>

	* vfs.c (vfs_add_noncurrent_stamps): Fixed typo reported by Andrej
	Borsenkow <borsenkow.msk@sni.de>

Tue Oct 13 12:42:10 1998  Pavel Machek  <pavel@atrey.karlin.mff.cuni.cz>

	* vfs.h (vfs_struct): renamed to avoid namespace conflict

Mon Oct 12 22:42:30 1998  Pavel Machek  <pavel@bug.ucw.cz>

	* sfs.c: reuse mmap from local.c

	* ftpfs.c, fish.c, shared_ftp_fish.c: horrible reget hack removed,
	and replaced with open(,O_LINEAR); lseek() combination

Sun Oct 11 01:44:37 1998  Pavel Machek  <pavel@bug.ucw.cz>

	* mcfs.c (open_tcp_link): Moved: it used to be in utilvfs.c, but
	as it deals with portmapper, it is probably usefull for mcfs

	* vfs.h (MCERR_*): these are no longer needed

	* vfs.c (vfs_translate_url): translating of url's moved to vfs
	code

	* all around: trying to reduce namespace pollution. All special
	functions (like extfs_run) should be done using mc_setctl()
	interface. At the end, all non-static functions in vfs layer
	should begin with vfs_ and should be declared in vfs.h (however
	that goal is far away).

	* all over the code: replace X_vfs_ops to vfs_X_ops

Mon Oct  5 20:11:01 1998  Pavel Machek  <pavel@bug.ucw.cz>

	* vfs.c: added stat to avoid hiding files by naming them
	#ftp:localhost and similar. Vfs will not treat files as local if
	they already exists, regardless of name.

Tue Oct  6 15:34:22 1998  Pavel Machek  <pavel@atrey.karlin.mff.cuni.cz>

	* vfs.h: disable BROKEN_PATHS by default. See if you can live
	without cd .. from ftp tree putting you to last directory.

Sat Oct  3 14:28:57 1998  Norbert Warmuth  <nwarmuth@privat.circular.de>

	* ftpfs.c (resolve_symlink): fixed cut'n paste error in my last
	change, i.e. make it compile)

Sat Oct  3 01:03:37 1998  Norbert Warmuth  <nwarmuth@privat.circular.de>

	* ftpfs.c (resolve_symlink): minor speed enhancement

Thu Oct  1 18:39:52 1998  Pavel Roskin  <pavel_roskin@geocities.com>

	* vfs.h: vfs_force_expire() was incorrectly #define'd

Tue Sep 29 17:23:03 1998  Pavel Machek  <pavel@atrey.karlin.mff.cuni.cz>

	* extfs.c, sfs.c: added few static's to prevent people from doing
	stupid things

Mon Sep 28 21:43:16 1998  Norbert Warmuth  <nwarmuth@privat.circular.de>

	* vfs.h (struct vfs): renamed errno to verrno because glibc2
	defines errno as macro (#define errno (*__errno_location ()))

Mon Sep 28 21:34:03 1998  Norbert Warmuth  <nwarmuth@privat.circular.de>

	* Makefile.in: search config.status in builddir and not in srcdir/..,
	i. e. make it compile for builddir != srcdir

Sun Sep 27 16:16:52 1998  Pavel Machek  <pavel@bug.ucw.cz>

	* COPYING.LGPL, all over the code: code is now under Library
	General Public License (instead of GPL), so non-free applications
	can link to it.

Wed Sep 23 22:37:40 1998  Pavel Machek  <pavel@bug.ucw.cz>

	* all over the code: added (vfs *) as first argument for functions
	that have no other way to know what fs they belong to. This will
	be used by object-like tricks, which will allow us to do real
	code-sharing: I do not like #including of .c files.

1998-09-25  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* shared_ftp_fish.c: Addaed prototypes for linear_start, linear_read,
	linear_close

Wed Sep 23 15:09:55 1998  Tom Tromey  <tromey@cygnus.com>

	* vfs.h (MIN, MAX): Only define if not already defined; glib.h
	also defines them.

Wed Sep 23 13:33:14 1998  Pavel Machek  <pavel@ucw.cz>

	* ftpfs.c: Fixed segfault caused by unitialized varialble

Wed Sep 23 11:51:12 1998  Pavel Roskin  <pavel_roskin@geocities.com)

	* ftpfs.c: Special characters were printed via print_vfs_message.
	This caused funny effects if "XTerm hintbar" was on.

Mon Sep 21 11:40:30 1998  Pavel Machek  <pavel@ucw.cz>

	* ftpfs.c, fish.c: added O_LINEAR mode to handle linear read of
	files in sane way. copy_file_file will make temporary files for a
	while (fix pending).

	* tar.c: fixed bzip/bzip2 compressed archives

Wed Sep 18 12:51:51 1998  Pavel Machek  <pavel@ucw.cz>

	* fish.c, vfs.c: created aliases /#ssh: and /#rsh:

	* vfs.h: created ERRNOR() macro which sets my_errno and returns,
	which makes vfs's _much_ more readable

Fri Sep 18 10:37:28 1998  Pavel Roskin  <pavel_roskin@geocities.com)

	* extfs.c: free() was called twice for the same place in memory
	in extfs_open()

Tue Sep 15 20:31:32 1998  Norbert Warmuth  <k3190@fh-sw.de>

	* ftpfs.c (ftp_use_unix_list_options): New global variable/option.
	If true we try to use 'LIST -la <path>'. When it fails we use the
	two commands 'CWD <path>' and 'LIST' instead.

	(resolve_symlink): rewritten. Don't get a second directory listing
	with `LIST -lLa'. Instead use the cache to get the file stat of
	symbolic links. If the directory the symlink points to isn't
	already in the cache the directory listing will be fetched and
	stored in the directory cache (without resolving symlinks
	recursively).
	The new method to resolve symlinks is faster if symlinks
	the same directory or the directory the symlink points to
	is already in the cache.
	This function was small and nice until I discovered that it was
	broken for symlinks to symlinks. Now it looks ugly and perhaps I
	will revert it to use "LIST -lLa" again. With a fast connection it
	doesn't matter which methode we use but with a slow connection I
	wouldn't hesitate to burn more cpu cycles on the client side.

	(retrieve_dir): Added parameter to tell whether to resolve
	symlinks (don't resolve symlinks in directory listings retrieved
	while resolving symlinks).
	When we don't get a directory listing with 'LIST -la <path>' then
	try to get it with `CWD <path>; LIST'.

Tue Sep 15 20:27:29 1998  Norbert Warmuth  <k3190@fh-sw.de>

	* ftpfs.c (login_server): s/ftpfs_get_host/my_get_host/

	(retrieve_file_start2): Don't create target file O_EXCL, in
	copy_file_file we check existance of the target file and know
	that we want to truncate it (this change was already done a
	while back but it was reverted with the vfs-split).

Tue Sep 15 20:15:42 1998  Norbert Warmuth  <k3190@fh-sw.de>

	* ftpfs.h (struct connection): added boolean which indicates that
	the ftp server doesn't understand Unix ls options

	* ftpfs.h (struct dir): added enum to store symlink status of the
	in memory directory cache (directory has no symbolic links;
	symbolic links but not yet resolved; symbolic links which are resolved)

Tue Sep 15 20:02:08 1998  Norbert Warmuth  <k3190@fh-sw.de>

	* shared_ftp_fish.c, fish.c: updated references to retrieve_dir to
	honour the additional boolean parameter

Tue Sep 15 00:42:15 1998  Timur Bakeyev  <mc@bat.ru>

	* vfs.h: add vfs_split() declaration, to make sfs.c happy.

	* Make-mc.in, Makefile.am: Updated to include fish.c

1998-09-14  Norbert Warmuth  <k3190@fh-sw.de>

	* sfs.c (sfs_free): assignment operator was used to check for equality

Fri Sep 11 22:36:38 1998  Pavel Machek  <pavel@ucw.cz>

	* sfs.c: memory leak fixed

	* vfs.c: split parse_ls_lga into more functions

	* fish.c added, now you can access files over rsh/ssh connection

	* shared*.c: reworked a bit not to include so many of ugly X_'s

Wed Sep  2 13:59:47 1998  Pavel Machek  <pavel@ucw.cz>

	* ftpfs.c: cleanup of code, few static's added

	* extfs/uarj: added, still, you need patches to unarj to make this
	work

	* util-alone.c: now includes code from libvfs.c, so we can kill
	libvfs.c (which is good thing as it was non-standard in Makefiles)

Sun Aug 30 13:19:49 1998  Pavel Machek  <pavel@ucw.cz>

	* undelfs.c: fixed, it has been broken for too long

	* vfs.c, ../src/cmd.c: neccessary minor fixes to make undelfs work

	* vfs.c: made more fields in *_vfs_ops optional, cleanup of errno
	handling in case of NULL in *_vfs_ops.

	* extfs.c, ftpfs.c, tar.c: made use of above change

	* vfs.c: cleanup of macros generating mc_*()

	* libvfs.c: adding variable mc_home

Thu Aug 27 19:45:31 1998  Pavel Roskin  <pavel_roskin@geocities.com>

	* extfs.c: mc_extfsdir was not defined in extfs_open()

	* Make-mc.in: sfs.c was not compiled, linked and copied out
	extfs/sfs.ini was not installed and copied out

	* Makefile.am: sfs.c was not linked to standalone VFS

Tue Aug 25 17:54:17 1998  Pavel Machek  <pavel@ucw.cz>

	* Added vfs_uid for use by libvfs.so users (rpc.nfsd)

	* Added single file filesystem (sfs)

	* Added vfs_flags so library users can disable selected
	filesystems

	* Minor shuffling of functions so garbage collection works for
	library

1998-08-20  Raja R Harinath  <harinath@cs.umn.edu>

	* Makefile.am (mad.c, mad.h): Create symlinks to counterparts in
	`mc-src'.

Wed Aug 12 19:04:48 1998  Pavel Roskin  <pavel_roskin@geocities.com>

	* extfs/patchfs: %k replaced with more portable %H in the format
	for "date" command

	* extfs/extfs.ini: Added patchfs and mailfs. Some comments
	changed

Tue Aug 11 15:25:52 1998  Pavel Roskin  <pavel_roskin@geocities.com>

	* extfs/rpm: Fix for buggy "cut" on HP-UX 10.20 which ignores
	lines without enf-of-line.

Mon Jun 01 03:30:07 1998  Alexander Savelyev  <fano@vcom.kiev.ua>

	* tar.c (read_header): Support for linkflag on BSDI tar (pax), it
	is always 0.

1998-06-22  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* ftpfs.c (ftpfs_open_socket): Potential security break fix.

1998-08-06  Raja R Harinath  <harinath@cs.umn.edu>

	* Makefile.am (BUILT_SOURCES): Make it `make dist' friendly.
	Don't try building this, yet.

1998-07-31  Nuno Ferreira  <nmrf@rnl.ist.utl.pt>

	* Make-mc.in (install.extfs): Splitted install of $(EXTFS_CONST)
	and $(EXTFS_OUT) because the first must be installed from
	$(srcdir) and the second from $(builddir).

Fri Jul 24 00:22:30 1998  Tom Tromey  <tromey@cygnus.com>

	* Make-mc.in (DISTVFS): Changed Makefile.in to Make-mc.in.

	* Makefile.am: New file.
	* Make-mc.in: Renamed from Makefile.in.
	* Makefile.in: Removed.

Mon Jun 29 15:12:55 1998  Pavel Roskin  <pavel_roskin@geocities.com>

	* Makefile.in: Rewritten stuff concerning extfs files.

Mon Jun 22 22:30:00 1998  Manish Vachharajani  <mvachhar@vger.rutgers.edu>

	* Makefile.in: Remove arfs, since it doesn't seem to exist

Wed Jun 17 Pavel Machek  <pavel@ucw.cz>
	* Rename helper scripts (extfs/{rar|lha|...}.in), so their names
	are more logical (and so that things actually work, because new
	names are currently in extfs.ini).

Wed Jun 17 Pavel Machek  <pavel@ucw.cz>
	* Modified code to use tempnam() instead of tmpnam(), fixed
	tempnam() to use NULL instead of 0.

Wed Jun  3 Pavel Machek  <pavel@ucw.cz>

	* libvfs.c: adding libvfs.c which should contain things specific
	to stand-alone libvfs.so. (This file was missing from previous
	merge.)

Mon Jun  1 16:00:19 1998  Norbert Warmuth  <k3190@fh-sw.de>

	* ftpfs.c (ftpfs_fill_names): use right character to seperate
	prefix and username

Mon Jun  1 14:19:20 1998  Bakeyev I. Timur  <mc@bat.ru>
	* vfs.c (parse_ls_lga): allow a bit wider range of listings.

	* vfs.c (is_time, is_year): new functions

Mon Jun  1 12:47:50 1998  Norbert Warmuth  <k3190@fh-sw.de>

	* ftpfs.c (ftpfs_forget): Use the new ftpfs prefix.

Thu May 28 16:42:31 1998  Pavel Machek  <pavel@ucw.cz>

	* extfs.c, shared.c, tar.c: I changed semantics in my previous
	patch - _get_path() now modifies strings passed to it. I thought
	that I were carefull enough not to introduce bugs. You guessed it -
	I was not. [Many tar_ and extfs_ functions modify strings passed
	to them, but as they are only called from vfs layer, it does not
	matter much.]
	So I renamed function to alert everyone that semantics changed.

	Fixed bugs in timestamping (and segfaults) when you entered tar
	inside zip file or similar.

	* vfs.c (mc_open): Die if the filesystem doesn't support open

???         Pavel Machek <pavel@ucw.cz>

	* shared.c: Shared parts of extfs.c and tar.c are now in shared.c

	* util-alone.*: VFS should be able to compile stand-alone into
	libvfs.so usable by anyone. This is first step.

	* vfs.c & others: syntax change. We no longer use
	tar:/path.tar/file. Now, syntax is /path.tar#utar/file, which has
	better defined meaning. Similar changes are done to all other
	protocols. This change touched really _many_ places of code.


1998-05-26  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* vfs.c (MC_DIROP): Macro now returns the proper value.

1998-maj-18  Tamasi Gyorgy (gt_cosy@usa.net)

	* Makefile.in ('install' target): 'mcserv' not installed, if
	net-code is not enabled by 'configure'.

Thu May 14 02:05:52 1998  Norbert Warmuth  <k3190@fh-sw.de>

	* Makefile.in (LIBS): add @LINTL@

Sun May 10 14:51:03 1998  Norbert Warmuth  <k3190@fh-sw.de>

	* ftpfs.c (__ftpfs_chdir): CWD command wasn't sent at all. This
	optimation is wrong because for directories containing spaces we
	have to "CWD <pathname>" and "LIST -la" instead of
	"LIST -la <pathname>".
	I implemented a different optimation. Now ftpfs_chdir only stores
	the new working directory and sets a flag. __ftpfs_chdir is called
	when we really want to change the directory on the ftp server.

	(resolve_symlink): Log the directory listing to the logfile.

	* ftpfs.h (struct ftpfs_connection): Added a (per connection)
	cwd_defered flag.

Mon May  4 10:27:49 1998  Norbert Warmuth  <k3190@fh-sw.de>

	* Makefile.in: Links to mad.c and mad.h were created wrong when
	srcdir != builddir and directory depth to srcdir and builddir were
	different (e.g. srcdir=/src/mc and builddir=/src/compile/mc)

	* ftpfs.c (retrieve_file_start2): Don't create target file O_EXCL,
	in copy_file_file we check existance of the target file and know
	that we want to truncate it.

1998-04-29  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* tar.c (read_header): Mark regular files with S_IFREG.

Tue Apr 28 06:06:03 1998  Norbert Warmuth  <k3190@fh-sw.de>

	* extfs.c (extfs_open, extfs_close): Changed my_system(1,...) to
	my_system(EXECUTE_AS_SHELL,...), this fixes the broken copyin and
	copyout of 4.1.32.

1998-04-23  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* ftpfs.c (retrieve_file_start2): Open file exclusively.
	(retrieve_file): likewise.

1998-03-31  Philippe De Muyter  <phdm@macqel.be>

	* vfs.h: compilation fix for m68k-motorola-sysv

Wed Mar 25 19:01:48 1998  Norbert Warmuth  <k3190@fh-sw.de>

	* extfs/hp48: Added a usage summary

Mon Mar 23 00:42:21 1998  Christofer Edvardsen  <ce@earthling.net>

	* Makefile.in, extfs/extfs.ini, extfs/hp48: New external
	filesystem to view and copy files to/from the HP48.

Wed Feb 11 14:09:02 1998  Oleg  <oleg@pobox.com>

	* extfs.c: Add support for writtable external file systems.
	Required for the httpfs.

Fri Jan 23 07:27:37 1998  Peter Daum  <gator@cs.tu-berlin.de>

	* extfs.c (open_extfs_archive): Pass the quoted argument to the
	list command.

	* mailfs: new file system.

1997-12-21  Yuri Kuzmenko  <Yuri.Kuzmenko@f169.n463.z2.fidonet.org>

	* tar.c: fix the bug which core dumps when trying to view tar file
	with many files (over 60000).

Mon Jul 21 18:47:37 1997  Miguel de Icaza  <miguel@athena.nuclecu.unam.mx>

	* vfs.c (mc_opendir): Do not make conversions between int/void *
	to make the code compile and work on the Alpha correctly.
	Allocate a pointer to an int and use that instead.

Thu Jul  3 19:08:43 1997  Michele Marziani  <marziani@axpfe1.fe.infn.it>

	* extfs/rpm: Small fix for older RPM files.

Mon Jun  9 19:00:30 1997  Norbert Warmuth  <k3190@fh-sw.de>

	* vfs/vfs.c (vfs_canon): Fix for the 'cd a:/somedir/..' problem

	* vfs/vfs.c (vfs_add_non_current_stamps): when leaving a mtools fs
	free the extfs buffers immediatly instead of waiting for the vfs-
	timeout

Thu May 29 14:50:41 1997  Miguel de Icaza  <miguel@athena.nuclecu.unam.mx>

	* vfs.c (vfs_canon): the "local:" case was consuming one extra
	character.  This fixes the bug reported by Andrej.  Also, handle
	the non-canonical case of arguments to  local:

Tue May 27 20:38:28 1997  Miguel de Icaza  <miguel@athena.nuclecu.unam.mx>

	* mcserv.c (get_client): The parent now waits for the first forked
	process, getting rid of the zombies.

	* utilvfs.c (open_tcp_link): If we can not contact the remote
	portmapper, set the protocol version to 1.

Fri May 16 16:42:18 1997  Tomasz K³oczko, <kloczek@rudy.mif.pg.gda.pl>

	* mc.spec: New spec file, this packages mc, mcserv and tkmc.

	* lib/mcserv.init, lib/mc.sh, lib/mcserv.pamd: added

	* vfs/ext/rpm: instead using sed and rpm -qpi use rpm queries,
	more info currently displayed (changeslogs, Os, URL, packager

Tue May 13 18:14:49 1997  Wojtek Pilorz  <wpilorz@bdk.lublin.pl>

	* vfs/Makefile.in (INSTALL_PROGRAM): Use -m flag for install to
	force vfs scripts to be executable on those systems that use
	install.sh

	* src/utilunix.c: Implement socketpair for SCO flavored systems.

Mon Mar 17 12:03:50 1997  Norbert Warmuth  <k3190@fh-sw.de>

	* configure.in (--with-hsc): fix.

	* vfs/ftpfs.c (ftpfs_get_proxy_host_and_port): Fixed wrong parameter
	passing (HSC_DEFAULT_PORT was passed as pointer to char instead of
	passing it as integer)

Tue Feb 25 20:21:00 1997  Joseph M. Hinkle  <jhinkle@rockisland.com>

	* extfs/lha: Updated the lha filesystem and included a command
	for running an executable from within an lha archive suggested
	by Zdenek Kabelac <kabi@informatics.muni.cz>

	* extfs/: Renamed cpio, deb, rar, rpm as *.in files and altered
	config.in to create these VFS's for cleaner compilation

