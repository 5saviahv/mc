# This is the "Makefile.in" that is used when vfs is built as part of
# mc.  Any changes here must also be made in Makefile.am.
# x

srcdir = @srcdir@
top_srcdir = @top_srcdir@
VPATH = @srcdir@
mkinstalldirs = $(SHELL) $(top_srcdir)/mkinstalldirs
top_builddir = ..

@MCF@

SAMBA_INCLUDES =

CFLAGS   = $(XCFLAGS)
CPPFLAGS = $(XCPPFLAGS) -I. $(SAMBA_INCLUDES)
LDFLAGS  = $(XLDFLAGS)
DEFS     = $(XDEFS)
LIBS     = @LINTL@ @SHADOWLIB@ $(XLIBS) @TERMNET@ @PAMLIBS@ @LCRYPT@ $(XLIB)
INSTALL  = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@ -m 755
INSTALL_DATA = @INSTALL_DATA@
AR = @AR@

#
# VFS code
#
@USE_SAMBA_FS_TRUE@SMB_NETFILES = smbfs.o
@USE_SAMBA_FS_FALSE@SMB_NETFILES =
NETFILES   = tcputil.o fish.o ftpfs.o mcfs.o utilvfs.o $(SMB_NETFILES)

SAMBA_DIST_TOPLEVEL =		\
	Makefile.in		\
	acconfig.h		\
	aclocal.m4		\
	architecture.doc	\
	configure.in		\
	configure		\
	internals.doc		\
	parsing.doc

SAMBA_DIST_INCLUDE =		\
	byteorder.h		\
	charset.h		\
	client.h		\
	config.h.in		\
	dlinklist.h		\
	includes.h		\
	kanji.h			\
	local.h			\
	nameserv.h		\
	ntdomain.h		\
	nterr.h			\
	proto.h			\
	rpc_dce.h		\
	rpc_lsa.h		\
	rpc_misc.h		\
	rpc_netlogon.h		\
	rpc_reg.h		\
	rpc_samr.h		\
	rpc_secdes.h		\
	rpc_srvsvc.h		\
	rpc_wkssvc.h		\
	rpcclient.h		\
	smb.h			\
	stamp-h.in		\
	trans2.h		\
	version.h

SAMBA_DIST_LIB =		\
	charcnv.c		\
	charset.c		\
	debug.c			\
	doscalls.c		\
	genrand.c		\
	getsmbpass.c		\
	interface.c		\
	kanji.c			\
	md4.c			\
	netmask.c		\
	signal.c		\
	slprintf.c		\
	system.c		\
	time.c			\
	username.c		\
	util.c			\
	util_file.c		\
	util_sock.c		\
	util_str.c		\
	util_unistr.c

SAMBA_DIST_LIBSMB =		\
	clientgen.c		\
	namequery.c		\
	nmblib.c		\
	nterr.c			\
	pwd_cache.c		\
	smbdes.c		\
	smbencrypt.c		\
	smberr.c

SAMBA_DIST_PARAM =		\
	loadparm.c		\
	params.c

SAMBA_DIST_TESTS =		\
	README			\
	ftruncate.c		\
	getgroups.c		\
	summary.c		\
	trivial.c

NONETFILES = 			\
	cpio.o			\
	direntry.o		\
	extfs.o 		\
	local.o 		\
	names.o			\
	tar.o			\
	sfs.o			\
	vfs.o @undelfs_o@

VFSSRCS = \
	container.c 		\
	cpio.c			\
	direntry.c		\
	extfs.c 		\
	ftpfs.c 		\
	fish.c 			\
	local.c 		\
	local.h			\
	mcfs.c			\
	names.c 		\
	mcserv.c 		\
	sfs.c 			\
	shared_tar_ext.c 	\
	shared_ftp_fish.c	\
	smbfs.c			\
	tar.c 			\
	tcputil.c		\
	undelfs.c 		\
	utilvfs.c		\
	util-alone.c		\
	vfs.c

VFSHDRS = 			\
	container.h 		\
	extfs.h 		\
	fish.h			\
	ftpfs.h 		\
	mcfs.h 			\
	names.h 		\
	smbfs.h			\
	tar.h 			\
	tcputil.h 		\
	utilvfs.h		\
	vfs.h			\
	util-alone.h		\
	xdirentry.h

VFSOBJS = $(NONETFILES) @NETFILES@

Makefile: $(srcdir)/Make-mc.in $(top_builddir)/config.status
	cd $(top_builddir) && \
	  CONFIG_FILES=vfs/Makefile:vfs/Make-mc.in \
	  CONFIG_HEADERS= $(SHELL) ./config.status


#
# Distribution variables
#

DISTVFS = Make-mc.in ChangeLog callback.h README README.fish \
	$(VFSSRCS) $(VFSHDRS)

all: @LIBVFS@ @mcserv@
	cd extfs && $(MAKE) all

.c.o:
	$(CC) -c $(CPPFLAGS) $(DEFS) $(CFLAGS) $<

check:
	@echo no tests are supplied.

SRC_LINKS = mad.c mad.h

$(SRC_LINKS):
	for i in $(SRC_LINKS); do \
		$(LN_S) $(mcsrcdir)/$$i . || exit 1; \
	done

mcserv: mcserv.o tcputil.o mad.o
	$(CC) $(LDFLAGS) -o mcserv mcserv.o tcputil.o mad.o $(LIBS)

@USE_SAMBA_FS_TRUE@libvfs-mc.a: $(VFSOBJS) samba/libsamba.a
@USE_SAMBA_FS_FALSE@libvfs-mc.a: $(VFSOBJS)
	rm -f $@
@USE_SAMBA_FS_TRUE@	cp -f samba/libsamba.a libtmp.a
@USE_SAMBA_FS_TRUE@	$(AR) r libtmp.a $(VFSOBJS)
@USE_SAMBA_FS_TRUE@	mv libtmp.a $@
@USE_SAMBA_FS_FALSE@	$(AR) cr $@ $(VFSOBJS)
	$(RANLIB) $@

samba/libsamba.a:
	cd samba && $(MAKE) libsamba.a

showlibdep:
	@echo 'OBJS="$(VFSOBJS)"'

TAGS: $(VFSSRCS)
	etags $(VFSSRCS)

mostlyclean:
	(cd extfs && $(MAKE) mostlyclean)
	if test -f samba/Makefile; then \
	  (cd samba && $(MAKE) mostlyclean); \
	else :;	fi
	rm -f *.o core a.out

clean: mostlyclean
	(cd extfs && $(MAKE) clean)
	if test -f samba/Makefile; then \
	  (cd samba && $(MAKE) clean); \
	else :;	fi
	rm -f mcserv *.a

distclean: clean
	(cd extfs && $(MAKE) distclean)
	if test -f samba/Makefile; then \
	  (cd samba && $(MAKE) distclean); \
	else :;	fi
	rm -f $(SRC_LINKS)
	rm -f .depend
	rm -f TAGS
	rm -f *~
	rm -f Makefile

install: install_@mcserv@ install.extfs

install_:

install_mcserv:
	$(mkinstalldirs) $(DESTDIR)$(bindir)
	$(INSTALL_PROGRAM) mcserv $(DESTDIR)$(bindir)/$(binprefix)mcserv

install.extfs:
	cd extfs && $(MAKE) install

uninstall:
	(cd extfs && $(MAKE) uninstall)
	rm -f $(DESTDIR)$(bindir)/$(binprefix)mcserv

distdir = $(top_builddir)/$(PACKAGE)-$(VERSION)/$(subdir)

distdir:
	for I in $(DISTVFS); \
	  do cp -p $(srcdir)/$$I $(distdir) || exit 1; \
	done
	$(mkinstalldirs) $(distdir)/extfs
	(cd extfs && $(MAKE) $(AM_MAKEFLAGS) top_distdir=../$(top_distdir) \
		distdir=../$(distdir)/extfs distdir) || exit 1
	mkdir $(distdir)/samba
	mkdir $(distdir)/samba/include
	mkdir $(distdir)/samba/lib
	mkdir $(distdir)/samba/libsmb
	mkdir $(distdir)/samba/param
	mkdir $(distdir)/samba/tests
	for I in $(SAMBA_DIST_TOPLEVEL); do \
	  cp -p $(srcdir)/samba/$$I $(distdir)/samba \
	  || exit 1; done
	for I in $(SAMBA_DIST_INCLUDE); do \
	  cp -p $(srcdir)/samba/include/$$I $(distdir)/samba/include \
	  || exit 1; done
	for I in $(SAMBA_DIST_LIB); do \
	  cp -p $(srcdir)/samba/lib/$$I $(distdir)/samba/lib \
	  || exit 1; done
	for I in $(SAMBA_DIST_LIBSMB); do \
	  cp -p $(srcdir)/samba/libsmb/$$I $(distdir)/samba/libsmb \
	  || exit 1; done
	for I in $(SAMBA_DIST_PARAM); do \
	  cp -p $(srcdir)/samba/param/$$I $(distdir)/samba/param \
	  || exit 1; done
	for I in $(SAMBA_DIST_TESTS); do \
	  cp -p $(srcdir)/samba/tests/$$I $(distdir)/samba/tests \
	  || exit 1; done
	
depend dep: mcdep

fastdeploc:

# ***Dependencies***Do not edit***
@DOTDEPEND@
# ***End of dependencies***
