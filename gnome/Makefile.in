srcdir = @srcdir@
top_srcdir = @top_srcdir@
VPATH = @srcdir@
mkinstalldirs = $(SHELL) $(top_srcdir)/mkinstalldirs
top_builddir = ..

top_srcdir = $(srcdir)/..
@MCF@

GNOMEDEFS     = -DHAVE_X -DHAVE_GNOME @GNOME_INCLUDEDIR@

CFLAGS        = $(XCFLAGS)
CPPFLAGS      = $(XCPPFLAGS) -I. -I$(gnomedir) -I$(mcsrcdir) $(GNOMEDEFS)
LDFLAGS       = $(XLDFLAGS) @GNOME_LIBDIR@ @GNOMEUI_LIBS@
CORBA_LDFLAGS = $(XLDFLAGS) @GNOME_LIBDIR@ @GNOMEGNORBA_LIBS@
DEFS = $(XDEFS)
LIBS = $(XLIBS) @TERMNET@
EXTRALIBS = -L../vfs @LVFS@ -L../gtkedit -lgtkedit @LINTL@
DEPLIBS = $(top_builddir)/vfs/@LIBVFS@ \
	$(top_builddir)/gtkedit/@libgtkedit@ @INTLDEPS@
INSTALL = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
INSTALL_DATA = @INSTALL_DATA@

PIXMAPS =			\
	dev.xpm			\
	link.xpm		\
	listing-list.xpm	\
	listing-iconic.xpm	\
	listing-custom.xpm	\
	listing-brief-list.xpm	\
	dir-close.xpm		\
	dir-open.xpm

GNOMESRCS =					\
	gaction.c				\
	gcache.c				\
	gcliplabel.c				\
	gcustom-layout.c			\
	gcmd.c					\
	gcorba.c				\
	gdesktop-icon.c				\
	gdesktop-init.c				\
	gdesktop-prefs.c			\
	gdesktop.c				\
	gdialogs.c				\
	gdnd.c					\
	ghelp.c					\
	gicon.c					\
	ginfo.c					\
	gkey.c					\
	glayout.c				\
	gmain.c					\
	gmount.c				\
	gmc-chargrid.c				\
	gmenu.c					\
	gmetadata.c				\
	gpageprop.c				\
	gpopup2.c				\
	gprefs.c				\
	gprint.c				\
	gprop.c					\
	gnome-file-property-dialog.c		\
	gnome-open-dialog.c			\
	gscreen.c				\
	gsession.c				\
	gtools.c				\
	gtkdtree.c				\
	gtkflist.c				\
	gtree.c					\
	gutil.c					\
	gview.c					\
	gwidget.c

GNOMEHDRS =					\
	gcache.h				\
	gcliplabel.h				\
	gcmd.h					\
	gconf.h					\
	gcorba.h				\
	gcustom-layout.h			\
	gdesktop-icon.h				\
	gdesktop-init.h				\
	gdesktop-prefs.h			\
	gdesktop.h				\
	gdnd.h					\
	gicon.h					\
	gmain.h					\
	gmount.h				\
	gmc-chargrid.h				\
	gmetadata.h				\
	gpageprop.h				\
	gpopup.h				\
	gprefs.h				\
	gprint.h				\
	gprop.h					\
	gnome-file-property-dialog.h		\
	gnome-open-dialog.h			\
	gscreen.h				\
	gsession.h				\
	gtkdtree.h				\
	gtkflist.h				\
	gtree.h					\
	gwidget.h

ICONS = 			\
	i-blockdev.png		\
	i-cdrom.png		\
	i-chardev.png		\
	i-core.png		\
	i-dirclosed.png		\
	i-directory.png		\
	i-executable.png	\
	i-fifo.png		\
	i-floppy.png		\
	i-nfs.png		\
	i-printer.png		\
	i-regular.png		\
	i-sock.png		\
	i-stalled.png		\
	i-symlink.png		\
	i-zipdisk.png		\
	i-zipdisk2.png

#
# These objects are made from sources in ../src
#
OOBJS = dlg.o screen.o widget.o wtools.o boxes.o		\
	file.o find.o dialog.o key.o view.o			\
	panelize.o hotlist.o background.o dir.o util.o		\
	win.o color.o profile.o user.o ext.o setup.o		\
	subshell.o terms.o fsusage.o mountlist.o		\
	regex.o complete.o command.o				\
	cmd.o utilunix.o xslint.o filenot.o			\
	fileopctx.o treestore.o mad.o

CORBAOBJS = 			\
	main-corba.o		\
	gcorba.o		\
	gmount-corba.o          \
	magicdev-common.o 	\
	magicdev-stubs.o	\
	FileManager-skels.o	\
	FileManager-stubs.o	\
	FileManager-common.o

OBJS =						\
	$(OOBJS)				\
	gaction.o				\
	gcache.o				\
	gcliplabel.o				\
	gcmd.o					\
	gcustom-layout.o			\
	gdialogs.o				\
	gdesktop-icon.o				\
	gdesktop-init.o				\
	gdesktop-prefs.o			\
	gdesktop.o				\
	gdnd.o					\
	ghelp.o					\
	gicon.o					\
	ginfo.o					\
	gkey.o					\
	glayout.o				\
	gmain.o					\
	gmc-chargrid.o				\
	gmenu.o					\
	gmetadata.o				\
	gpageprop.o				\
	gpopup2.o				\
	gprefs.o				\
	gprint.o				\
	gprop.o					\
	gnome-file-property-dialog.o		\
	gnome-open-dialog.o			\
	gscreen.o				\
	gsession.o				\
	gtools.o				\
	gtree.o					\
	gutil.o					\
	gview.o					\
	gtkdtree.o				\
	gtkflist.o				\
	gwidget.o

NORMALOBJS =	 \
	gmount.o \
	main.o

CORBA_GENERATED =		\
	FileManager.h		\
	FileManager-stubs.c	\
	FileManager-skels.c	\
	FileManager-common.c

MAGICDEV_GENERATED =            \
	magicdev-common.c 	\
	magicdev-stubs.c	\
	magicdev.h

CLIENTSRCS = gmc-client.c

CLIENTOBJS = 			\
	gmc-client.o		\
	FileManager-stubs.o	\
	FileManager-common.o


$(CORBA_GENERATED): $(top_srcdir)/idl/FileManager.idl
	orbit-idl `gnome-config --cflags idl` $(top_srcdir)/idl/FileManager.idl

$(MAGICDEV_GENERATED): $(srcdir)/magicdev.idl
	orbit-idl `gnome-config --cflags idl` --noskels $(srcdir)/magicdev.idl

FileManager-impl.c: FileManager.h

EXTRA_DIST =			\
	gnome.TODO		\
	layout			\
	gmc.gnorba		\
	mc.keys.in.in		\
	gimp.image.desktop	\
	magicdev.idl		\
	application.x-gnumeric.desktop

DISTGNOME = \
	Makefile.in ChangeLog $(EXTRA_DIST) $(CORBA_SOURCES) \
	$(PIXMAPS) $(ICONS) $(GNOMESRCS) $(GNOMEHDRS) \
	$(CLIENTSRCS) gmc-window.c gmc-window.h

.c.o:
	$(CC) -c $(CPPFLAGS) $(DEFS) $(CFLAGS) $<

main-corba.o: main.c
	$(CC) -c -DHAVE_CORBA $(CPPFLAGS) $(DEFS) $(CFLAGS) main.c -o main-corba.o

gmount-corba.o: gmount.c
	$(CC) -c -DHAVE_CORBA $(CPPFLAGS) $(DEFS) $(CFLAGS) $(srcdir)/gmount.c -o gmount-corba.o

gcorba.o: gcorba.c $(CORBA_GENERATED)
gmount.o: gmount.c $(MAGICDEV_GENERATED)

all: @mx@ Makefile mc.keys

Makefile: Makefile.in ../config.status
	(cd ..; CONFIG_FILES=gnome/Makefile CONFIG_HEADERS= ./config.status)

mx: checklinks
	$(MAKE) plain-gmc
	$(MAKE) corba-gmc
	$(MAKE) gmc-client
	@echo ----------------------------------------------------------
	@echo -
	@echo - GMC no longer exists here.  Use plain-gmc or corba-gmc
	@echo - if you are debugging/working on this.
	@echo -
	@echo -----------------------------------------------------------
	@touch mx

plain-gmc: $(OBJS) $(NORMALOBJS) $(DEPLIBS)
	$(CC) -o plain-gmc $(NORMALOBJS) $(OBJS) $(EXTRALIBS) $(LDFLAGS) $(LIBS)

corba-gmc: $(OBJS) $(CORBAOBJS) $(DEPLIBS)
	$(CC) -o corba-gmc $(CORBAOBJS) $(OBJS) $(EXTRALIBS) $(CORBA_LDFLAGS) $(LIBS)

gmc-client: $(CLIENTOBJS)
	$(CC) -o gmc-client $(CLIENTOBJS) $(CORBA_LDFLAGS) $(LIBS)

mc.keys: mc.keys.in Makefile
	sed -e 's^\@icondir\@^$(icondir)^g' \
	    -e 's^\@gnomeicondir\@^$(gnomeicondir)^g' \
	< mc.keys.in > mc.keys.tmp \
	&& mv mc.keys.tmp mc.keys

mc.keys.in: mc.keys.in.in Makefile.in ../config.status
	(cd ..; CONFIG_FILES=gnome/mc.keys.in CONFIG_HEADERS= ./config.status)

checklinks:
	@if test -f regex.c; then : ; \
	else $(MAKE) sourcelinks; fi

sourcelinks:
	for i in $(OOBJS) main.o; do \
		f=`echo $$i | sed -e 's/\\.o$$//'`.c; \
		rm -f $$f; \
		$(LN_S) $(mcsrcdir)/$$f . || exit 1; \
	done

cleansourcelinks:
	-if test -f regex.c; then \
	    find . -lname '*.c' | xargs rm -f; \
	fi

check:
	@echo no tests are supplied.

TAGS: $(GNOMESRCS)
	etags $(GNOMESRCS)

mostlyclean:
	rm -f *.o core a.out mc.keys.in

clean: mostlyclean
	rm -f plain-gmc corba-gmc gmc-client mx mc.keys \
	  $(CORBA_GENERATED) $(MAGICDEV_GENERATED)

distclean: clean cleansourcelinks
	rm -f .depend
	rm -f TAGS
	rm -f *~
	rm -f Makefile

distdir = $(top_builddir)/$(PACKAGE)-$(VERSION)/$(subdir)

distdir:
	for I in $(DISTGNOME); \
	  do cp -p $(srcdir)/$$I $(distdir) || exit 1; \
	done

install: install_@mx@

install_:

install_mx: all
	$(mkinstalldirs) $(DESTDIR)$(bindir)
	$(mkinstalldirs) $(DESTDIR)$(icondir)
	$(mkinstalldirs) $(DESTDIR)$(mclibdir)
	$(mkinstalldirs) $(DESTDIR)$(datadir)/mime-info
	$(mkinstalldirs) $(DESTDIR)$(corbadir)
	$(mkinstalldirs) $(DESTDIR)$(gnewdir)
	$(INSTALL_PROGRAM) plain-gmc $(DESTDIR)$(bindir)/$(binprefix)plain-gmc
	$(INSTALL_PROGRAM) corba-gmc $(DESTDIR)$(bindir)/$(binprefix)gmc
	$(INSTALL_PROGRAM) gmc-client $(DESTDIR)$(bindir)/$(binprefix)gmc-client
	for I in $(ICONS); \
	do $(INSTALL_DATA) $(srcdir)/$$I $(DESTDIR)$(icondir)/$$I; done
	$(INSTALL_DATA) $(srcdir)/layout $(DESTDIR)$(mclibdir)/layout
	$(INSTALL_DATA) mc.keys $(DESTDIR)$(datadir)/mime-info
	$(INSTALL_DATA) $(srcdir)/gmc.gnorba $(DESTDIR)$(corbadir)

uninstall:
	rm -f $(DESTDIR)$(bindir)/$(binprefix)gmc
	rm -f $(DESTDIR)$(bindir)/$(binprefix)gmc-client
	rm -f $(DESTDIR)$(bindir)/$(binprefix)plain-gmc
	for I in $(ICONS); \
	do rm -f $(DESTDIR)$(icondir)/$$I; done
	-rmdir $(DESTDIR)$(icondir)
	rm -f $(DESTDIR)$(mclibdir)/layout
	rm -f $(DESTDIR)$(datadir)/mime-info/mc.keys
	-rmdir $(DESTDIR)$(datadir)/mime-info
	-rmdir $(DESTDIR)$(gnewdir)
	rm -f $(DESTDIR)$(corbadir)/gmc.gnorba
	-rmdir $(DESTDIR)$(corbadir)

depend dep: @gmcdep@

gmcdep: checklinks mcdep

fastdeploc: @fastdepslang@ @fastdepvfs@

# ***Dependencies***Do not edit***
@DOTDEPEND@
# ***End of dependencies***
