srcdir = @srcdir@
VPATH = @srcdir@

rootdir = $(srcdir)/..
@MCFG@@MCF@

CFLAGS =   $(XCFLAGS) @X_CFLAGS@
CPPFLAGS = $(XCPPFLAGS) -I$(vfsdir) -I$(slangdir) -DHAVE_X -DHAVE_GNOME @GNOME_INCLUDEDIR@ 
LDFLAGS = $(XLDFLAGS) @GNOME_LIBDIR@ @GNOMEUI_LIBS@
DEFS = $(XDEFS)
LIBS = @X_EXTRA_LIBS@ -lX11 @X_PRE_LIBS@ $(XLIBS) $(XLIB) @TERMNET@
EXTRALIBS = @LVFS@ -lgtkedit @LINTL@
INSTALL = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
INSTALL_DATA = @INSTALL_DATA@

GNOMESRCS = 		\
	gblist.c	\
	gcache.c	\
	gcliplabel.c	\
	gcmd.c		\
	gdesktop-icon.c	\
	gdesktop.c 	\
	gdnd.c		\
	ghelp.c 	\
	ginfo.c 	\
	gkey.c 		\
	glayout.c 	\
	gmain.c 	\
	gmc-chargrid.c	\
	gmenu.c		\
	gmetadata.c	\
	gpageprop.c	\
	gpopup.c	\
	gprop.c		\
	gdialogs.c	\
	gscreen.c 	\
	gtools.c 	\
	gtkdtree.c	\
	gtree.c		\
	gutil.c		\
	gview.c		\
	gwidget.c

GNOMEHDRS = 		\
	gblist.h	\
	gcache.h	\
	gcliplabel.h	\
	gcmd.h		\
	gconf.h		\
	gdesktop-icon.h	\
	gdesktop.h	\
	gdnd.h		\
	gmain.h 	\
	gmc-chargrid.h	\
	gmetadata.h	\
	gpageprop.h	\
	gpopup.h	\
	gprop.h		\
	gdialogs.h	\
	gscreen.h	\
	gtkree.h	\
	gtree.h		\
	gwidget.h

ICONS = 			\
	directory.xpm		\
	i-directory.png		\
	i-executable.png	\
	i-symlink.png		\
	i-device.png		\
	i-regular.png		\
	i-core.png		\
	i-sock.png

#
# These objects from ../src do not depend on HAVE_X / HAVE_GNOME??
#
LOBJS = mad.o
# popt.o poptconfig.o \
#	popthelp.o poptparse.o findme.o

#
# These objects from ../src do depend on HAVE_GNOME
#
OOBJS = main.o dlg.o screen.o widget.o wtools.o info.o boxes.o \
	file.o find.o dialog.o key.o chmod.o chown.o view.o \
	panelize.o hotlist.o background.o dir.o util.o \
	win.o color.o profile.o user.o ext.o setup.o \
	subshell.o terms.o achown.o fsusage.o mountlist.o \
	@XCURSES@ @REGEX_O@ complete.o command.o \
	option.o cmd.o utilunix.o xslint.o filegui.o filenot.o 

OBJS = $(LOBJS) $(OOBJS) \
	gblist.o	\
	gcache.o	\
	gcliplabel.o	\
	gcmd.o		\
	gdesktop-icon.o	\
	gdesktop.o 	\
	gdnd.o		\
	ghelp.o 	\
	ginfo.o 	\
	gkey.o 		\
	glayout.o 	\
	gmain.o 	\
	gmc-chargrid.o 	\
	gmenu.o 	\
	gmetadata.o	\
	gpageprop.o	\
	gpopup.o	\
	gprop.o		\
	gscreen.o 	\
	gtools.o 	\
	gtree.o		\
	gutil.o 	\
	gview.o		\
	gtkdtree.o	\
	gwidget.o

#
# Distribution variables
#

PIXMAPS =			\
	dev.xpm			\
	link.xpm		\
	directory.xpm		\
	listing-list.xpm	\
	listing-iconic.xpm	\
	dir-close.xpm		\
	dir-open.xpm

DISTGNOME = Makefile.in gnome.TODO layout $(PIXMAPS) $(ICONS) $(GNOMESRCS) $(GNOMEHDRS) 

.c.o:
	$(CC) -c $(CPPFLAGS) $(DEFS) $(CFLAGS) $<

all: @gmc@ Makefile

Makefile: Makefile.in ../config.status
	(cd ..; CONFIG_FILES=gnome/Makefile CONFIG_HEADERS= ./config.status)

gmc: checklinks 
	$(MAKE) mx

mx: @LIBVFS@ $(OBJS) @LIBSLANG@ libgtkedit.a
	$(CC) $(LDFLAGS) -o gmc $(OBJS) -L../vfs -L../slang -L../gtkedit $(EXTRALIBS) $(LIBS) 
	touch mx

@LIBVFS@:
	cd ../vfs; $(MAKE) @LIBVFS@
@PCENTRULE@	-$(RMF) @LIBVFS@
@PCENTRULE@	$(LN_S) ../vfs/@LIBVFS@ .

libmcslang.a:
	cd ../slang; $(MAKE) libmcslang.a
@PCENTRULE@	-$(RMF) libmcslang.a
@PCENTRULE@	$(LN_S) ../slang/libmcslang.a .

libgtkedit.a:
	cd ../gtkedit; $(MAKE) libgtkedit.a
@PCENTRULE@	-$(RMF) libgtkedit.a
@PCENTRULE@	$(LN_S) ../gtkedit/libgtkedit.a .

checklinks:
	@if test -f $(gnomedir)/regex.c; then echo ok; \
	else $(MAKE) maksourcelinks; fi
	@if test -f regex.o; then echo ok; else $(MAKE) links; fi

links:
	for I in $(LOBJS); do $(RMF) $$I; $(LN_S) ../src/$$I $$I >/dev/null 2>&1; done; true

maksourcelinks:
	-cd $(gnomedir); $(LN_S) ../src/*.[ch] . >/dev/null 2>&1; $(LN_S) ../src/*.inc .; true

cleansourcelinks:
	-if test -f $(gnomedir)/regex.c; then \
	    cd $(gnomedir); find . \( -lname '*.[ch]' -o -lname '*.inc' \) | xargs $(RM); \
	fi

check:
	@echo no tests are supplied.

TAGS: $(GNOMESRCS)
	etags $(GNOMESRCS)

clean:
	$(RMF) @gmc@ *.o core a.out mx @LIBVFS@ libgtkedit.a libmcslang.a

realclean: clean
	$(RMF) .depend
	$(RMF) TAGS
	$(RMF) *~

distclean: cleansourcelinks
	-$(RMF) $(srcdir)/*~ $(srcdir)/*.o $(srcdir)/gmc $(srcdir)/core
	-$(RMF) $(srcdir)/a.out
	-if test $(srcdir) = .; then $(MAKE) realclean; fi
	-$(RMF) $(srcdir)/Makefile

distcopy:
	$(CP) $(DISTGNOME) ../../mc-$(VERSION)/gnome

install: install_@gmc@

install_:

install_gmc: all 
	$(mcsrcdir)/xmkdir $(DESTDIR)$(bindir)
	$(mcsrcdir)/xmkdir $(DESTDIR)$(icondir)
	$(mcsrcdir)/xmkdir $(DESTDIR)$(libdir)
	$(mcsrcdir)/xmkdir $(DESTDIR)$(bindir)
	$(INSTALL_PROGRAM) gmc $(DESTDIR)$(bindir)/$(binprefix)gmc
	for I in $(ICONS); \
	do $(INSTALL_DATA) $(srcdir)/$$I $(DESTDIR)$(icondir)/$$I; done
	$(INSTALL_DATA) $(srcdir)/layout $(DESTDIR)$(libdir)/layout

uninstall: 
	-$(RMF) $(DESTDIR)$(bindir)/$(binprefix)gmc
	for I in $(ICONS); \
	do $(RMF) $(DESTDIR)$(icondir)/$$I; done
	-rmdir $(DESTDIR)$(icondir)
	-$(RMF) $(DESTDIR)$(libdir)/layout

depend dep: @gmcdep@

gmcdep: checklinks mcdep

fastdeploc: @fastdepslang@ @fastdepvfs@

# ***Dependencies***Do not edit***
@DOTDEPEND@
# ***End of dependencies***
