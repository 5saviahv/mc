srcdir = @srcdir@
top_srcdir = @top_srcdir@
VPATH = @srcdir@
mkinstalldirs = $(SHELL) $(top_srcdir)/mkinstalldirs
top_builddir = ..

SHELL   = @SHELL@
@MCF@

CFLAGS   = $(XCFLAGS)
CPPFLAGS = $(XCPPFLAGS) @MCCFLAGS@ -DREGEX_MALLOC
LDFLAGS  = $(XLDFLAGS)
DEFS     = $(XDEFS)
LIBS     = $(XLIBS) @TERMNET@ $(XLIB) @TERMNET@ @MCLIBS@
OURLIBS  = @LVFS@ @LSLANG@ @LEDIT@ @LGPM@ @LINTL@
DEPLIBS  = $(top_builddir)/vfs/@LIBVFS@ $(top_builddir)/slang/@LIBSLANG@ \
	$(top_builddir)/edit/@LIBEDIT_A@ @INTLDEPS@
INSTALL  = @INSTALL@

INSTALL_PROGRAM = @INSTALL_PROGRAM@
INSTALL_DATA = @INSTALL_DATA@

@CHARSET_TRUE@CHARSET_OBJS = charsets.o selcodepage.o
@CHARSET_FALSE@CHARSET_OBJS =

SRCS =	dir.c util.c main.c screen.c dialog.c key.c keyxdef.c menu.c	\
	file.c win.c color.c help.c find.c profile.c user.c view.c	\
	ext.c mouse.c setup.c dlg.c option.c info.c			\
	tree.c widget.c chmod.c mad.c xcurses.c xslint.c		\
	wtools.c cons.handler.c chown.c subshell.c terms.c boxes.c	\
	hotlist.c achown.c layout.c fsusage.c mountlist.c regex.c	\
	complete.c slint.c command.c cmd.c panelize.c learn.c		\
	listmode.c utilunix.c background.c rxvt.c			\
	text.c popt.c findme.c poptparse.c poptconfig.c popthelp.c	\
	filegui.c filenot.c fileopctx.c treestore.c textconf.c		\
	charsets.c selcodepage.c

HDRS =	color.h file.h mouse.h user.h dialog.h find.h main.h		\
	util.h dir.h global.h menu.h panel.h win.h mem.h		\
	help.h profile.h dlg.h option.h tree.h info.h			\
	widget.h chmod.h cons.saver.h mad.h wtools.h chown.h		\
	subshell.h view.h setup.h key.h ext.h boxes.h			\
	hotlist.h layout.h fsusage.h mountlist.h eregex.h complete.h	\
	myslang.h command.h cmd.h tty.h fs.h panelize.h achown.h	\
	learn.h listmode.h background.h					\
	x.h textconf.h i18n.h findme.h popt.h filegui.h keys.h xtty.h	\
	poptint.h poptalloca.h fileopctx.h treestore.h			\
	charsets.h selcodepage.h

OBJS =	dir.o util.o screen.o dialog.o key.o keyxdef.o menu.o		\
	file.o win.o color.o help.o find.o profile.o user.o view.o	\
	ext.o mouse.o setup.o dlg.o option.o tree.o widget.o chmod.o	\
	mad.o wtools.o info.o cons.handler.o chown.o subshell.o		\
	terms.o boxes.o hotlist.o achown.o layout.o fsusage.o		\
	mountlist.o @XCURSES@ regex.o complete.o slint.o command.o	\
	cmd.o main.o panelize.o learn.o listmode.o utilunix.o		\
	background.o rxvt.o text.o popt.o findme.o poptparse.o		\
	poptconfig.o popthelp.o filegui.o filenot.o fileopctx.o		\
	treestore.o textconf.o $(CHARSET_OBJS)

#
# Distribution variables
#

DISTFILES = \
	$(HDRS) $(SRCS) Makefile.in TODO ChangeLog OChangeLog man2hlp.c \
	gindex.pl cons.saver.c ncurses.patch mc.hlp mfmt.c

all: mc mcmfmt $(srcdir)/mc.hlp @cons_saver@ Makefile

Makefile: $(srcdir)/Makefile.in $(top_builddir)/config.status
	cd $(top_builddir) && CONFIG_FILES=src/Makefile CONFIG_HEADERS= $(SHELL) ./config.status

.c.o:
	$(CC) -c $(CPPFLAGS) $(DEFS) $(CFLAGS) $<

cons.saver: cons.saver.o
	$(CC) $(LDFLAGS) cons.saver.o -o cons.saver

check:
	@echo no tests are supplied.

mc: $(OBJS) $(DEPLIBS)
	$(CC) $(LDFLAGS) -o $@ $(OBJS) -L../vfs -L../slang -L../edit $(OURLIBS) $(LIBS) 

man2hlp: man2hlp.o
	$(CC) $(LDFLAGS) man2hlp.o -o man2hlp

mcmfmt: mfmt.o
	$(CC) $(LDFLAGS) mfmt.o -o mcmfmt 

$(srcdir)/mc.hlp: @MAINT@ $(docdir)/mc.1.in $(mcsrclibdir)/xnc.hlp $(srcdir)/gindex.pl man2hlp.c
@MAINT@	$(MAKE) man2hlp
@MAINT@	- ./man2hlp 58 $(docdir)/mc.1.in | cat - $(mcsrclibdir)/xnc.hlp | \
@MAINT@	perl $(srcdir)/gindex.pl > $(srcdir)/mc.hlp.tmp && \
@MAINT@	mv -f $(srcdir)/mc.hlp.tmp $(srcdir)/mc.hlp; \
@MAINT@	rm -f $(srcdir)/mc.hlp.tmp; \
@MAINT@	touch $(srcdir)/mc.hlp

mc.html: $(docdir)/mc.1.in man2hlp
	./man2hlp 0 $(docdir)/mc.1.in > body.html
	cat index.html body.html > mc.html
	$(RM) index.html body.html

TAGS: $(SRCS)
	etags $(SRCS)

mostlyclean:
	rm -f *.o core a.out

clean: mostlyclean
	rm -f mc cons.saver man2hlp mc.html mcmfmt

distclean: clean
	rm -f TAGS
	rm -f *~
	rm -f Makefile

#
# Make sure to install mcview and mcedit after mc - important
# on systems without symlinks.
#
install: mc mcmfmt
	$(mkinstalldirs) $(DESTDIR)$(bindir)
	$(mkinstalldirs) $(DESTDIR)$(mclibdir)
	$(INSTALL_PROGRAM) mc     $(DESTDIR)$(bindir)/$(binprefix)mc
	$(INSTALL_PROGRAM) mcmfmt $(DESTDIR)$(bindir)/$(binprefix)mcmfmt
	$(SEDCMD2) < $(srcdir)/mc.hlp > $(DESTDIR)$(mclibdir)/mc.hlp 
	$(MAKE) install_mcview
	$(MAKE) install_@MCEDIT@
	$(MAKE) install_@cons_saver@

install_:

#
# Make relative symlinks, but do the right thing if LN_S is `ln' or `cp'.
#
install_mcview:
	cd $(DESTDIR)$(bindir)/$(binprefix) && rm -f mcview && $(LN_S) mc mcview

install_mcedit:
	cd $(DESTDIR)$(bindir)/$(binprefix) && rm -f mcedit && $(LN_S) mc mcedit

install_cons.saver: cons.saver
	$(mkinstalldirs) $(DESTDIR)$(suppbindir)
	$(INSTALL_PROGRAM) cons.saver $(DESTDIR)$(suppbindir)/cons.saver

uninstall:
	rm -f $(DESTDIR)$(bindir)/$(binprefix)/mc
	rm -f $(DESTDIR)$(bindir)/$(binprefix)/mcmfmt
	rm -f $(DESTDIR)$(suppbindir)/cons.saver
	rm -f $(DESTDIR)$(mclibdir)/mc.hlp
	rm -f $(DESTDIR)$(bindir)/$(binprefix)mcedit
	rm -f $(DESTDIR)$(bindir)/$(binprefix)mcview

distdir = $(top_builddir)/$(PACKAGE)-$(VERSION)/$(subdir)

distdir: $(srcdir)/mc.hlp
	for I in $(DISTFILES); \
	  do cp -p $(srcdir)/$$I $(distdir) || exit 1; \
	done

depend:

